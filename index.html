<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <title>Hex General Evolved - Modular</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!--<h1 style="color:red; position:fixed; top:0; left:0; z-index: 99999;">VERSI√ìN DE PRUEBA YYY</h1>-->
    <!-- ====================================================================== -->
    <!-- ===================== PANTALLA DE MEN√ö PRINCIPAL ===================== -->
    <!-- ====================================================================== -->
    <div id="mainMenuScreen" class="modal" style="display: none; text-align: center; align-items: center; justify-content: center;">
        <div class="modal-content" style="width: auto; min-width: 300px; max-width: 500px;">
            <h2>Hex General Evolved</h2>
            <button id="startCampaignBtn" style="display: block; width: 80%; margin: 20px auto; padding: 15px; font-size: 1.1em;">Comenzar Campa√±a</button>
            <button id="startSkirmishBtn" style="display: block; width: 80%; margin: 20px auto; padding: 15px; font-size: 1.1em;">Partida R√°pida (Escaramuza)</button>
        </div>
    </div>

    <!-- ====================================================================== -->
    <!-- ====== PANTALLA DE CONFIGURACI√ìN DE PARTIDA R√ÅPIDA (ESCARAMUZA) ====== -->
    <!-- ====================================================================== -->
    <div id="setupScreen" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>Configuraci√≥n de Partida R√°pida</h2>
            <div>
                <label for="player1Type">Jugador 1:</label>
                <select id="player1Type">
                    <option value="human" selected>Humano</option>
                    <option value="ai_easy">IA (F√°cil)</option>
                    <option value="ai_normal">IA (Normal)</option>
                    <option value="ai_hard">IA (Dif√≠cil)</option>
                </select>
            </div>
            <div id="player1AiLevelDiv" style="display:none;">
                <label for="player1AiLevel">Nivel IA Jugador 1:</label>
                <select id="player1AiLevel">
                    <option value="easy">F√°cil</option>
                    <option value="normal" selected>Normal</option>
                    <option value="hard">Dif√≠cil</option>
                </select>
            </div>

            <div>
                <label for="player2Type">Jugador 2:</label>
                <select id="player2Type">
                    <option value="human">Humano</option>
                    <option value="ai_easy">IA (F√°cil)</option>
                    <option value="ai_normal" selected>IA (Normal)</option>
                    <option value="ai_hard">IA (Dif√≠cil)</option>
                </select>
            </div>
            <div id="player2AiLevelDiv" style="display:block;">
                <label for="player2AiLevel">Nivel IA Jugador 2:</label>
                <select id="player2AiLevel">
                    <option value="easy">F√°cil</option>
                    <option value="normal" selected>Normal</option>
                    <option value="hard">Dif√≠cil</option>
                </select>
            </div>

            <div>
                <label for="resourceLevel">Nivel de Recursos:</label>
                <select id="resourceLevel">
                    <option value="min" selected>M√≠nimos</option>
                    <option value="med">Medios</option>
                    <option value="max">Muchos</option>
                </select>
            </div>

            <div>
                <label for="initialUnitsCount">L√≠mite Despliegue:</label>
                <select id="initialUnitsCount">
                    <option value="1">1 Unidad</option>
                    <option value="3" selected>3 Unidades</option>
                    <option value="5">5 Unidades</option>
                    <option value="unlimited">Ilimitadas</option>
                </select>
            </div>

            <button id="startGameBtn">Empezar Juego</button>
            <button id="backToMainMenuBtn_fromSetup" style="margin-top:15px; background-color: #6c757d; width:auto; padding: 10px 15px;">Volver al Men√∫</button>
        </div>
    </div>

    <!-- ====================================================================== -->
    <!-- =================== PANTALLA DEL MAPA MUNDIAL (CAMPA√ëA) =================== -->
    <!-- ====================================================================== -->
    <div id="worldMapScreen" style="display: none; position: relative; width: 90%; max-width: 960px; height: 640px; margin: 20px auto; border: 2px solid #333; background-color: #a7bbc7; overflow: hidden;">
        <img id="worldMapImage" src="" alt="Mapa del Mundo" style="width: 100%; height: 100%; object-fit: contain;">
        <div id="territoryMarkerContainer" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></div>
        <div id="campaignMessages" class="floating-messages bottom-left">Mensajes de campa√±a...</div>
        <button id="backToMainMenuBtn_fromCampaign" class="floating-btn top-right" style="font-size: 16px; width: auto; padding: 5px 10px; border-radius: 5px;">Men√∫</button>
    </div>

    <!-- ====================================================================== -->
    <!-- ================== MODAL DE BRIEFING DEL ESCENARIO ================== -->
    <!-- ====================================================================== -->
    <div id="scenarioBriefingModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 700px;">
            <span class="close-button" id="closeScenarioBriefingBtn" title="Cerrar">√ó</span>
            <h2 id="scenarioTitle" style="text-align:center; margin-bottom:15px;">T√≠tulo</h2>
            <img id="scenarioImage" src="" alt="Escenario" style="max-width: 100%; max-height: 300px; margin:0 auto 20px; display:none;">
            <p id="scenarioDescription">Descripci√≥n...</p>
            <button id="startScenarioBattleBtn" style="font-size: 1.1em; padding: 12px 20px;">Comenzar Batalla</button>
        </div>
    </div>

    <!-- ====================================================================== -->
    <!-- =================== CONTENEDOR DEL JUEGO T√ÅCTICO =================== -->
    <!-- ====================================================================== -->
    <div class="game-container" style="display: none;">
        <div id="gameBoard"></div>

        <button id="floatingMenuBtn" class="floating-btn top-left">‚ãÆ</button>
        <button id="floatingEndTurnBtn" class="floating-btn bottom-right">‚ñ∫</button>
         <button id="floatingCreateDivisionBtn" class="floating-btn bottom-left" style="display: none; font-size: 20px;">‚ûï</button> 
        <!-- O usa un icono como üõ°Ô∏è+ o ‚ûï‚öîÔ∏è -->

         <div id="floatingMenuPanel" class="floating-panel top-left-panel" style="display: none;">
            <h4 id="floatingMenuTitle">Fase: - <br> Turno 1 - Jugador -</h4> <!-- ID a√±adido/confirmado para el t√≠tulo -->
            <div id="playerResourcesGrid_float" class="playerResourcesGrid_common">
                <div class="resource-labels"><span>Oro</span><span>Fe</span><span>Pi</span><span>Ma</span><span>Com</span></div>
                <div class="resource-values">
                    <span data-resource="oro">0</span><span data-resource="hierro">0</span>
                    <span data-resource="piedra">0</span><span data-resource="madera">0</span>
                    <span data-resource="comida">0</span>
                </div>
            </div>
            
            <button id="concedeBattleBtn_float" class="panel-button">Rendirse</button>
            <button id="saveGameBtn_float" class="panel-button">Guardar Partida</button>
            <label for="loadGameInput_float" class="button-like-label panel-button">Cargar Partida</label>
            <input type="file" id="loadGameInput_float" accept=".json" style="display: none;">
            <button id="backToMainFromBattleBtn" class="panel-button" style="background-color:#6c757d;">Volver al Men√∫ Principal</button>
        </div>

        <div id="contextualInfoPanel" class="floating-panel bottom-panel" style="display: none;">
            <div id="contextualHeader">
                <h3 id="contextualTitle">Informaci√≥n</h3>
                <button id="closeContextualPanelBtn" class="close-panel-btn">√ó</button>
            </div>
            <div id="contextualContent">
                <!-- Contenido para informaci√≥n de unidad/hex√°gono (generado por JS) -->
                <!-- Ejemplo de estructura para info de unidad:
                <div class="unit-name-editor">
                    <label for="selectedUnitNameInput_ctx">Nombre:</label>
                    <input type="text" id="selectedUnitNameInput_ctx" readonly>
                    <button id="editUnitNameBtn_ctx" title="Editar Nombre">‚úèÔ∏è</button>
                    <button id="saveUnitNameBtn_ctx" title="Guardar Nombre" style="display:none;">‚úîÔ∏è</button>
                </div>
                <p>A/D/M/I: <span id="selectedUnitStats_ctx">-</span><span>/</span><span id="selectedUnitInitiative_ctx">-</span></p>
                <p>Rango Vis/Atk: <span id="selectedUnitRange_ctx">-</span></p>
                <p>Salud: <span id="selectedUnitHealth_ctx">-</span>/<span id="selectedUnitMaxHealth_ctx">-</span></p>
                <p>Experiencia: <span id="selectedUnitExperience_ctx">-</span>/<span id="selectedUnitMaxExperience_ctx">-</span></p>
                <h4>Regimientos (<span id="regimentCount_ctx">0</span>):</h4>
                <ul id="selectedUnitRegimentsList_ctx" class="regiments-detailed-list"></ul>
                -->
            </div>
            <div id="contextualActions">
                <!-- Botones de acci√≥n contextuales (generados por JS) -->
                <!-- <button id="ctxCreateDivisionBtn">Crear Divisi√≥n</button> -->
                <!-- <button id="ctxBuildStructureBtn">Construir</button> -->
                <!-- <button id="ctxReinforceBtn">Reforzar</button> -->
            </div>
        </div>
        <div id="gameMessagesMobile" class="floating-messages bottom-center">
            <p>Mensajes del juego...</p>
        </div>
    </div>

    <!-- ====================================================================== -->
    <!-- =================== MODALES DE JUEGO T√ÅCTICO =================== -->
    <!-- ====================================================================== -->
    <div id="createDivisionModal" class="modal">
        <div class="modal-content">
            <span class="close-button">√ó</span> <!-- Este close-button es gen√©rico para todos los modales -->
            <h3>Crear Nueva Divisi√≥n</h3>
            <label for="divisionNameInput">Nombre Divisi√≥n:</label>
            <input type="text" id="divisionNameInput" value="Nueva Divisi√≥n"><br><br>
            <h4>Regimientos Disponibles:</h4>
            <ul id="availableRegimentsList"></ul>
            <h4>Regimientos en esta Divisi√≥n:</h4>
            <ul id="currentDivisionRegimentsList"></ul>
            <p>Coste Total: <span id="totalDivisionCostDisplay">0 Oro</span></p>
            <p>Stats Agregados: <span id="totalDivisionStatsDisplay">0/0/0/0/0/0</span></p>
            <button id="finalizeDivisionBtn">Finalizar y Colocar</button> <!-- ID CORRECTO -->
        </div>
    </div>

    <div id="buildStructureModal" class="modal">
        <div class="modal-content">
            <span class="close-button">√ó</span> <!-- Este close-button es gen√©rico -->
            <h3>Construir Estructura en (<span id="buildHexCoordsDisplay"></span>)</h3>
            <ul id="availableStructuresList"></ul>
            <button id="confirmBuildBtn" disabled>Construir Seleccionado</button> <!-- ID CORRECTO -->
        </div>
    </div>

    <!-- ====================================================================== -->
    <!-- ===================== CARGA DE SCRIPTS ===================== -->
    <!-- ====================================================================== -->
    <script src="constants.js"></script>
    <script src="state.js"></script>
    <script src="worldMapData.js"></script>
    <script src="maps/tactical_britain_coast_map.js"></script>
    <script src="scenarios/britain_defense_scenario.js"></script>

    <script src="domElements.js"></script> <!-- Debe cargarse ANTES de los scripts que usan sus variables -->
    <script src="utils.js"></script>
    <script src="uiUpdates.js"></script>
    <script src="boardManager.js?v=1"></script>
    <script src="unit_Actions.js"></script> <!-- O unitActions.js -->
    <script src="modalLogic.js"></script>
    <script src="aiLogic.js"></script>
    <script src="gameFlow.js"></script>
    <script src="saveLoad.js"></script>
    <script src="campaignManager.js"></script>
    <script src="main.js"></script>
</body>
</html>