/**
 * style.css - 100% Fiel al Original, Reorganizado Semánticamente
 *
 * ESTRUCTURA:
 * 1.  ESTILOS GENERALES Y GLOBALES (body, helpers)
 * 2.  CONTENEDORES PRINCIPALES (game-container, gameBoard)
 * 3.  COMPONENTES DEL TABLERO (hex, niebla, sprites)
 * 4.  COMPONENTES DE UNIDADES (unit, estados)
 * 5.  PANELES DE UI (contextual, predicción, flotantes)
 * 6.  BOTONES FLOTANTES
 * 7.  MODALES (base y específicos)
 *       - Modal Base
 *       - Menú Principal
 *       - Configuración y Campaña
 *       - Briefing de Escenario
 *       - Árbol de Tecnología
 *       - Gestión de Unidades (varios modales)
 *       - Wiki y Ayuda
 *       - Lobby Multijugador
 * 8.  ANIMACIONES (@keyframes)
 * 9.  ESTILOS DE DEPURACIÓN Y TUTORIAL
 * 10. MEDIA QUERIES (Diseño Adaptable)
 * 11. RECOMPENSAS VISUALES
 * 12. ESTILOS ANTIGUOS O DESHABILITADOS
 */

/* ========================================================================== */
/* 1. ESTILOS GENERALES Y GLOBALES
/* ========================================================================== */

body {
    margin: 0;
    overflow: hidden;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-image: url('images/IIBERION.png');
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    background-attachment: fixed;
    min-height: 100vh;
}

#game-wrapper {
    /* ESTA REGLA SOLO SE ENCARGA DE CENTRAR EL JUEGO Y NADA MÁS */
    width: 100vw;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 10px;
    box-sizing: border-box;
}

.button-danger {
    background-color: #dc3545;
    color: white;
    padding: 8px 16px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    font-size: 0.9em;
    transition: background-color 0.2s ease-in-out;
}
.button-danger:hover {
    background-color: #c82333;
}
.button-danger:disabled {
    background-color: #fadadd;
    color: #a3a3a3;
    cursor: not-allowed;
}

.button-secondary {
    background-color: #6c757d;
    color: white;
}

/* ========================================================================== */
/* 2. CONTENEDORES PRINCIPALES
/* ========================================================================== */

.game-container {
    display: flex;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    position: relative;
    justify-content: flex-start;
    align-items: flex-start;
   /* padding-bottom: 80px;*/
    box-sizing: border-box;
}

#gameBoard {
    display: grid;
    border: 2px solid #6c757d;
    /* background-color: #c2b280; */ /* <-- Comentamos o eliminamos el color sólido */
    background-color: rgba(194, 178, 128, 0.2); /* <-- Mismo color pero con 40% de opacidad */
    position: relative;
    align-self: flex-start;
    cursor: grab;
    transform-origin: 0 0;
    touch-action: none;
    flex-shrink: 0;
}
#gameBoard.grabbing {
    cursor: grabbing;
}


/* ========================================================================== */
/* 3. COMPONENTES DEL TABLERO (hex, niebla, sprites)
/* ========================================================================== */

.hex {
    width: 50px;
    height: 57.73px;
    background-color: #90ee90;
    clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
    position: absolute;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 9px;
    box-sizing: border-box;
    border: 1px solid transparent;
    transition: background-color 0.2s;
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
}
.hex:hover {
    border-color: #ffc107;
}

/* --- Tipos de Terreno --- */
/*.hex.plains { background-color:#90EE90; }
.hex.forest { background-color: #6B8E23; }
.hex.hills { background-color: #A9A9A9; }
.hex.water { background-color: #87CEEB; }
*/

/*.hex.plains { background-color: #a08d75; } /* Tono Tierra Seca */*/
.hex.plains { background-color:#cbefcb; }
.hex.forest { background-color: #556b2f; } /* Verde Oliva Oscuro */
.hex.hills { background-color: #A9A9A9; } /* Tono Roca/Tierra */
.hex.water { background-color: #4682b4; } /* Azul Acero (SteelBlue) */

/* --- Resaltados de Acción (Highlights) --- */
.hex.highlight-move { background-color: rgba(0, 255, 0, 0.4); }
.hex.highlight-attack { background-color: rgba(255, 0, 0, 0.4); }
.hex.highlight-build { background-color: rgba(255, 165, 0, 0.4); }

/** DUPLICADO: Estas reglas de highlight son más específicas y probablemente las que se usan. */
.hex.highlight-move { background-color: rgba(0, 255, 0, 0.4) !important; border: 2px solid #00FF00; }
.hex.highlight-attack { background-color: rgba(255, 0, 0, 0.4) !important; border: 2px solid #FF0000; }
.hex.highlight-build { background-color: rgba(255, 165, 0, 0.4) !important; border: 2px solid #FFA500; }
.hex.highlight-place { background-color: rgba(0, 162, 255, 0.4) !important; border: 2px solid #00A2FF; }

.hex.highlight-move:hover,
.hex.highlight-attack:hover,
.hex.highlight-build:hover,
.hex.highlight-place:hover {
    border-color: yellow;
}

/* --- Propiedad y Estructuras --- */
.hex.player1-owner {
    box-shadow: inset 0 0 0 3px rgba(0, 0, 255, 0.6);
    --owner-color: rgba(0, 0, 255, 0.6);
}
.hex.player2-owner {
    box-shadow: inset 0 0 0 3px rgba(255, 0, 0, 0.6);
    --owner-color: rgba(255, 0, 0, 0.6);
}

.hex.player3-owner { box-shadow: inset 0 0 0 3px rgba(0, 0128, 0, 0.6); --owner-color: rgba(0, 128, 0, 0.6); } /* Verde */
.hex.player4-owner { box-shadow: inset 0 0 0 3px rgba(255, 255, 0, 0.6); --owner-color: rgba(255, 255, 0, 0.6); } /* Amarillo */
.hex.player5-owner { box-shadow: inset 0 0 0 3px rgba(128, 0, 0, 0.6); --owner-color: rgba(128, 0, 128, 0.6); } /* Púrpura */
.hex.player6-owner { box-shadow: inset 0 0 0 3px rgba(255, 165, 0, 0.6); --owner-color: rgba(255, 165, 0, 0.6); } /* Naranja */
.hex.player7-owner { box-shadow: inset 0 0 0 3px rgba(0, 255, 255, 0.6); --owner-color: rgba(0, 255, 255, 0.6); } /* Cian */
.hex.player8-owner { box-shadow: inset 0 0 0 3px rgba(255, 192, 203, 0.6); --owner-color: rgba(255, 192, 203, 0.6); } /* Rosa */

.hex.city::before { content: '🏠'; font-size: 18px; opacity: 0.7; }
.hex.capital-city::before { content: '👑'; font-size: 20px; opacity: 0.9; }

/** DUPLICADO: Regla más detallada para capital-city */
.hex.capital-city::before {
    content: '👑';
    font-size: 24px;
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%) scale(1.2);
    text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
    pointer-events: none;
    z-index: 10;
}
.hex.capital-city .structure-sprite { z-index: 5; }

.hex .bonus-sprite {
    position: absolute;
    font-size: 16px;
    top: 2px;
    left: 2px;
    opacity: 0.8;
    z-index: 6; /* Un poco por encima del sprite de estructura */
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
}

/* --- Sprites de Recursos --- */
.hex.resource-hierro::after { content: 'Fe'; font-size: 10px; color: #663300; position: absolute; top: 2px; right: 2px;}
.hex.resource-madera::after { content: 'Wd'; font-size: 10px; color: #228B22; position: absolute; top: 2px; right: 2px;}

/** DUPLICADO: Reglas más completas y con emojis para recursos */
.hex.resource-hierro::after,
.hex.resource-oro::after,
.hex.resource-piedra::after,
.hex.resource-madera::after,
.hex.resource-comida::after {
    content: "";
    position: absolute;
    top: 3px; right: 3px;
    font-size: 14px;
    opacity: 0.7;
    pointer-events: none;
}
.hex.resource-hierro::after { content: "⛏️"; color: #8B4513; }
.hex.resource-oro::after { content: "💰"; }
.hex.resource-piedra::after { content: "⛰️"; color: #708090; }
.hex.resource-madera::after { content: "🌲"; color: #228B22; }
.hex.resource-comida::after { content: "🌾"; color: #DAA520; }

.hex .structure-sprite {
    position: absolute;
    font-size: 18px;
    bottom: 1px;
    right: 1px;
    opacity: 0.9;
    z-index: 5;
}
/** DUPLICADO: Ajuste para que los sprites de estructura no se solapen con los de recursos */
.hex .structure-sprite {
    bottom: 3px;
    left: 3px;
    right: auto;
}

/* --- Niebla de Guerra --- */
.hex.fog-hidden { background-color: #777 !important; background-image: none !important; }
.hex.fog-hidden::before, .hex.fog-hidden::after, .hex.fog-hidden .structure-sprite { display: none; }
.hex.fog-partial { filter: grayscale(70%) brightness(0.8); }
.hex.fog-partial .unit:not(.player-controlled-visible) { display: none !important; }

/* --- Efectos de Estado --- */
.hex.owner-change-effect { animation: ownerChangeFlash 0.5s forwards; }
.hex.hit-effect { animation: hexHitFlash 0.3s ease-out; }

/* ========================================================================== */
/* 4. COMPONENTES DE UNIDADES
/* ========================================================================== */

.unit {
    position: absolute;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    cursor: pointer;
    transition: transform 0.2s, left 0.3s ease-out, top 0.3s ease-out;
    border: 2px solid black; /* Borde exterior, siempre visible */
    box-sizing: border-box;
    z-index: 10;
    pointer-events: none;

    /* 1. Forzamos el color de fondo a ser transparente SIEMPRE.
          Esto anula los colores de .player1 y .player2. */
    background-color: transparent !important;
    
    /* 2. Propiedades explícitas para la imagen de fondo (tu sprite). */
    background-size: 85%; /* Hacemos la imagen un poco más pequeña que el círculo para que respire */
    background-repeat: no-repeat;
    background-position: center center; /* ¡Esto la centra perfectamente! */

    /* 3. La sombra ahora se aplica a la imagen, no al círculo. */
    filter: drop-shadow(2px 2px 2px rgba(0, 0, 0, 0.6));
}

/* Esta regla se mantiene igual, es para la barra de vida */
.unit-strength {
    position: absolute;
    bottom: -16px;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(255, 255, 255, 0.9);
    padding: 1px 4px;
    border-radius: 3px;
    font-size: 0.7em;
    white-space: nowrap;
    border: 1px solid #aaa;
}

.player1 { background-color: #add8e6; border-color: #0000ff; }
.player2 { background-color: #f08080; border-color: #ff0000; }

.unit.player-controlled-visible { display: flex !important; }

.selected-unit {
    box-shadow: 0 0 12px 4px gold;
    transform: scale(1.1);
}

.unit-damaged { animation: shake 0.5s; }
.unit-destroyed { animation: explode 0.5s forwards; }
.unit-retreat { opacity: 0.7; }
.unit.hit { animation: unitHit 0.3s ease-out; }
.unit.attacking { animation: unitAttacking 0.2s ease-out; }
/** DUPLICADO: Esta regla hace que la unidad desaparezca suavemente, complementando la animación de explosión. */
.unit.unit-destroyed {
    opacity: 0;
    transition: opacity 0.5s ease-out;
    pointer-events: none;
}

.damage-dealt-text {
    position: absolute;
    font-size: 20px;
    font-weight: bold;
    color: #e74c3c;
    text-shadow: 1px 1px 2px black;
    z-index: 110;
    pointer-events: none;
    animation: floatAndFade 1.2s ease-out forwards;
}

.commander-banner {
    position: absolute;
    bottom: -5px;
    right: -8px;
    font-size: 14px;
    background-color: rgba(0, 0, 0, 0.7);
    border-radius: 50%;
    width: 18px;
    height: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
    border: 1px solid gold;
    text-shadow: none;
}
/* --- Modal: Cuartel de Héroes --- */
.hero-collection-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 15px;
    margin-top: 20px;
    max-height: 60vh;
    overflow-y: auto;
    padding: 10px;
    background-color: #e9ecef;
    border-radius: 5px;
}

.hero-card {
    border: 2px solid #adb5bd;
    border-radius: 8px;
    padding: 10px;
    text-align: center;
    background-color: #fff;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
}
.hero-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}
.hero-card .hero-sprite { font-size: 48px; }
.hero-card .hero-name { font-weight: bold; margin: 5px 0; }
.hero-card .hero-level { font-size: 0.9em; color: #6c757d; }
.hero-card .hero-stars { color: #ffc107; }

/* Estilos de Borde por Rareza */
.hero-card.Común { border-color: #adb5bd; }
.hero-card.Raro { border-color: #007bff; }
.hero-card.Épico { border-color: #8a2be2; }
.hero-card.Legendario { border-color: #ffc107; }

/* ========================================== */
/* ==       IMAGEN DEL HÉROE         == */
/* ========================================== */
.hero-card-image {
    width: 80px;  /* Ajusta el tamaño a tu gusto */
    height: 80px;
    border-radius: 8px; /* Un poco de borde redondeado */
    object-fit: cover;  /* Asegura que la imagen cubra el espacio sin deformarse */
    margin-bottom: 10px;
}

/* ======================================================== */
/* ==       MODAL DE DETALLES DE HÉROE (ESTILO ROK)       == */
/* ======================================================== */

#heroDetailModal .modal-content.hero-detail-content-rok {
    max-width: 950px; /* Más ancho para las 3 columnas */
    width: 90%;
    background-color: #e9ecef;
    border: 2px solid #adb5bd;
    padding: 15px;
}

.hero-main-layout {
    display: grid;
    grid-template-columns: 250px 1fr 250px; /* Habilidades | Centro | Talentos */
    gap: 20px;
    align-items: flex-start;
}

.hero-column {
    background-color: #fff;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.column-title {
    text-align: center;
    margin-top: 0;
    margin-bottom: 15px;
    color: #343a40;
    border-bottom: 1px solid #dee2e6;
    padding-bottom: 10px;
}

/* --- Columna Izquierda: Habilidades --- */
.skills-list .skill-item-rok {
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 15px;
}
.skill-item-rok .skill-icon {
    width: 60px;
    height: 60px;
    font-size: 32px;
    border: 2px solid #ced4da;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    position: relative;
}
.skill-item-rok .skill-icon.active { border-color: #dc3545; }
.skill-item-rok .skill-level {
    position: absolute;
    bottom: -5px;
    right: -5px;
    background-color: #495057;
    color: white;
    font-size: 0.8em;
    font-weight: bold;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    line-height: 24px;
    text-align: center;
    border: 2px solid #fff;
}
.skill-item-rok .skill-info h5 { margin: 0 0 5px 0; }
.skill-item-rok .skill-info p { margin: 0; font-size: 0.85em; color: #6c757d; }
.skill-item-rok .skill-upgrade-btn { /* Tu botón '+' se mantiene igual */ }

/* --- Columna Central: Retrato y Progresión --- */
.hero-center-column {
    display: flex;
    flex-direction: column;
    align-items: center;
}
#hero-portrait-container {
    width: 150px;
    height: 150px;
    border: 4px solid #adb5bd;
    border-radius: 12px;
    margin-bottom: 10px;
    overflow: hidden; /* Para contener la imagen */
}
#hero-portrait-container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}
.hero-name-title { text-align: center; margin-bottom: 20px; }
.hero-name-title h2 { margin: 0; }
.hero-name-title p { margin: 3px 0 0 0; color: #6c757d; font-style: italic; }

#hero-progression-bars { width: 100%; }
#hero-progression-bars .progress-item { /* Tus estilos de progress-item se mantienen */ }
#hero-progression-bars .xp-bar-container { /* Tus estilos de xp-bar-container se mantienen */ }
#hero-progression-bars .xp-bar { /* Tus estilos de xp-bar se mantienen */ }

.hero-action-buttons {
    display: flex;
    justify-content: space-around;
    width: 100%;
    margin-top: 20px;
    padding-top: 15px;
    border-top: 1px solid #dee2e6;
}

/* --- Columna Derecha: Talentos y Equipo --- */
.hero-talents-column .tabs {
    display: flex;
    margin-bottom: 15px;
    border-bottom: 2px solid #dee2e6;
}
.tab-button {
    flex: 1;
    padding: 10px;
    border: none;
    background-color: transparent;
    cursor: pointer;
    font-size: 1em;
    font-weight: 500;
    color: #6c757d;
}
.tab-button.active {
    color: #007bff;
    border-bottom: 2px solid #007bff;
}
.tab-content { display: none; }
.tab-content.active { display: block; }

/* --- Pop-up de Detalles de Habilidad --- */
.skill-detail-content {
    max-width: 450px;
    background-color: #fff;
    border: 2px solid #343a40;
    border-radius: 10px;
}

.skill-detail-header {
    display: flex;
    align-items: center;
    gap: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid #dee2e6;
}
.skill-detail-header .skill-icon {
    width: 60px;
    height: 60px;
    font-size: 32px;
}
.skill-detail-header h3, .skill-detail-header p {
    margin: 0;
}

.skill-detail-body {
    padding: 15px 0;
}
.skill-detail-body h4 {
    margin-top: 10px;
    margin-bottom: 10px;
}
#skillLevelPreview .level-row {
    font-size: 0.9em;
    padding: 4px 8px;
    border-radius: 4px;
    margin-bottom: 3px;
}
#skillLevelPreview .level-row.current {
    background-color: #d4edda; /* Verde claro para el nivel actual */
    font-weight: bold;
}

.skill-detail-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 15px;
    padding-top: 10px;
    border-top: 1px solid #dee2e6;
}
#skillUpgradeCost {
    font-size: 0.9em;
    color: #6c757d;
}
#upgradeSkillBtn {
    background-color: #28a745;
    color: white;
    padding: 8px 16px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}
#upgradeSkillBtn:disabled {
    background-color: #6c757d;
    cursor: not-allowed;
}

/* ========================================== */
/* ==       BOTONES DE HABILIDAD     == */
/* ========================================== */
.skill-upgrade-btn {
    margin-left: 10px;
    padding: 0px 8px;
    font-size: 1.2em;
    line-height: 1.2;
    font-weight: bold;
    color: white;
    background-color: #28a745;
    border: 1px solid #1e7e34;
    border-radius: 50%;
    cursor: pointer;
    transition: transform 0.1s;
}
.skill-upgrade-btn:hover {
    transform: scale(1.1);
    background-color: #218838;
}
.skill-unlock-req {
    font-size: 0.8em;
    font-style: italic;
    color: #6c757d;
}

/* ========================================== */
/* ==       NUEVO: HÉROES BLOQUEADOS        == */
/* ========================================== */
.hero-card.is-locked {
    background-color: #e9ecef;
    opacity: 0.75;
    filter: grayscale(90%);
    position: relative;
    border-color: #6c757d;
}

.hero-card.is-locked::after {
    content: '🔒';
    position: absolute;
    top: 5px;
    right: 5px;
    font-size: 24px;
    background-color: rgba(0,0,0,0.5);
    border-radius: 50%;
    width: 30px;
    height: 30px;
    line-height: 30px;
    text-align: center;
    color: white;
}

.hero-fragments-progress {
    font-size: 0.9em;
    font-weight: bold;
    color: #0056b3; /* Un color que resalte incluso en la tarjeta gris */
    margin-top: 5px;
}

/* ========================================================================== */
/* 9. ESTILOS DE TUTORIAL (VERSIÓN FINAL, ROBUSTA Y CORRECTA)
/* ========================================================================== */

/* --- RESALTADO PARA BOTONES Y ELEMENTOS DE UI (SIN CAMBIOS, PERO INCLUIDO) --- */
.tutorial-highlight {
    box-shadow: 0 0 0 4px gold, 0 0 0 8px rgba(0, 255, 255, 0.7) !important;
    animation: pulseHighlight 1.5s infinite alternate ease-in-out;
    z-index: 2002 !important;
    position: relative; /* Mantiene el z-index funcionando */
}

/* --- RESALTADO PARA HEXÁGONOS (APLICADO DIRECTAMENTE AL HEX, SIN ::BEFORE) --- */
.hex.tutorial-highlight-hex {
    /* box-shadow: inset dibuja el brillo DENTRO de la forma del clip-path */
    box-shadow: inset 0 0 4px 3px gold, inset 0 0 8px 6px cyan;
    
    /* Le damos un z-index para asegurar que se vea por encima de otros hexágonos */
    z-index: 5;
    
    /* La animación se aplica sobre la opacidad para un pulso suave */
    animation: pulseHighlightOpacity 1.5s infinite alternate ease-in-out;
}

/* --- ANIMACIONES PARA EL RESALTADO --- */
@keyframes pulseHighlight { 
    from { transform: scale(1); }
    to { transform: scale(1.03); }
}

@keyframes pulseHighlightOpacity {
    from {
        opacity: 0.7;
    }
    to {
        opacity: 1;
    }
}

/* ========================================================================== */
/* --- Panel de Predicción de Combate --- */
/* ========================================================================== */
#combat-prediction-panel {
    background-color: rgba(0, 0, 0, 0.85);
    color: white;
    padding: 8px 12px;
    border-radius: 5px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    font-size: 0.9em;
    z-index: 10001;
    pointer-events: none;
    white-space: nowrap;
    box-shadow: 0 2px 10px rgba(0,0,0,0.5);
    display: none;
}
#combat-prediction-panel p { margin: 3px 0; }
#combat-prediction-panel p span { font-weight: bold; }
/** DUPLICADO: Regla con ID diferente y más detallada */
#combatPredictionPanel {
    position: fixed;
    background-color: rgba(20, 20, 20, 0.9);
    color: #f0f0f0;
    padding: 10px 15px;
    border: 1px solid #555;
    border-radius: 8px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    font-size: 0.9em;
    z-index: 10001;
    pointer-events: none;
    white-space: nowrap;
    box-shadow: 0 4px 8px rgba(0,0,0,0.4);
    transition: opacity 0.1s linear;
    opacity: 0;
}
#combatPredictionPanel.visible { opacity: 1; }
#combatPredictionPanel h4 {
    margin: 0 0 8px 0;
    color: #f39c12;
    font-size: 1.1em;
    text-align: center;
    border-bottom: 1px solid #444;
    padding-bottom: 5px;
}
#combatPredictionPanel p { margin: 5px 0; line-height: 1.4; }
#combatPredictionPanel span.attacker-damage { color: #e74c3c; font-weight: bold; }
#combatPredictionPanel span.defender-damage { color: #3498db; font-weight: bold; }
#combatPredictionPanel span.critical-info { color: #f1c40f; font-weight: bold; display: block; text-align: center; margin-top: 8px; }

/* --- Panel de Menú Flotante --- */
.floating-panel {
    position: fixed; z-index: 90;
    background-color: rgba(245, 245, 245, 0.95);
    border: 1px solid #ccc;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    padding: 15px;
    transition: transform 0.3s ease-out, opacity 0.3s ease-out;
    display: none;
}
#floatingMenuPanel { top: 70px; left: 10px; width: 260px; }
#floatingMenuPanel h4 { text-align: center; margin-top: 0; margin-bottom: 10px; font-size: 1em; color: #333; }
#floatingMenuPanel #playerResourcesGrid_float { font-size: 0.85em; padding: 8px; margin-bottom: 10px; }
#floatingMenuPanel button, #floatingMenuPanel .button-like-label {
    width: 100%; display: block; margin-bottom: 8px; padding: 10px;
    text-align: left; background-color: #e9ecef; color: #333; border: 1px solid #ddd;
}
#floatingMenuPanel button:hover, #floatingMenuPanel .button-like-label:hover { background-color: #dee2e6; }
#floatingMenuPanel .resource-labels, #floatingMenuPanel .resource-values { grid-template-columns: repeat(7, 1fr); display: grid; }
#floatingMenuPanel #playerResourcesGrid_float {
    display: grid; grid-template-columns: repeat(7, 1fr); grid-template-rows: auto auto;
    gap: 4px 2px; padding: 8px; margin-bottom: 10px; background-color: #f8f9fa;
    border: 1px solid #e0e0e0; border-radius: 4px; text-align: center;
}
#floatingMenuPanel .resource-labels { grid-row: 1; grid-column: 1 / -1; display: contents; }
#floatingMenuPanel .resource-values { grid-row: 2; grid-column: 1 / -1; display: contents; }
#floatingMenuPanel .resource-labels span { font-size: 0.8em; font-weight: 500; color: #6c757d; }
#floatingMenuPanel .resource-values span { font-size: 0.9em; font-weight: bold; color: #212529; }

/* --- Panel de Turno del Oponente --- */
.turn-blocker {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 5000;
    display: flex; justify-content: center; align-items: center;
    font-size: 2.5em; color: white; text-shadow: 2px 2px 4px black;
    text-align: center; cursor: not-allowed;
}

/* ========================================================================== */
/* 6. BOTONES FLOTANTES
/* ========================================================================== */

.floating-btn {
    position: fixed; z-index: 100;
    background-color: rgba(0, 0, 0, 0.6); color: white;
    border: none; border-radius: 50%; width: 50px; height: 50px;
    font-size: 24px; display: flex; justify-content: center; align-items: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3); cursor: pointer;
    transition: background-color 0.2s, transform 0.1s ease;
}
.floating-btn:hover { background-color: rgba(0, 0, 0, 0.8); transform: scale(1.05); }
.floating-btn.top-left { top: 15px; left: 15px; }
.floating-btn.top-right { top: 15px; right: 15px; }
.floating-btn.bottom-right { bottom: 20px; right: 20px; }

#floatingUndoMoveBtn, #floatingReinforceBtn, #floatingSplitBtn, #floatingBuildBtn {
    width: 50px; height: 50px; border-radius: 50%; padding: 0;
    display: flex; justify-content: center; align-items: center;
    font-size: 1.5em; display: none;
}
#floatingMenuBtn:hover, #floatingTechTreeBtn:hover, #floatingEndTurnBtn:hover,
#floatingCreateDivisionBtn:hover, #floatingConsoleBtn:hover, #floatingUndoMoveBtn:hover,
#floatingReinforceBtn:hover, #floatingSplitBtn:hover, #floatingBuildBtn:hover {
    background-color: #555; transform: scale(1.05);
}

#floatingEndTurnBtn:hover { background-color: transparent !important; transform: scale(1.1); }
#floatingEndTurnBtn:active { background-color: transparent !important; transform: translateY(1px) scale(1.05); box-shadow: none !important; }

/* --- Posicionamiento específico --- */
/*#floatingEndTurnBtn        { bottom: 20px;  right: 20px; }
/*#floatingCreateDivisionBtn { bottom: 100px;  right: 20px; }
/*#floatingTechTreeBtn       { bottom: 160px; right: 20px; }
/*#floatingMenuBtn           { bottom: 220px; right: 20px; }
/*#floatingConsoleBtn        { bottom: 280px; right: 20px; font-size: 1.1em; padding: 10px 12px; }
/*#floatingWikiBtn           { bottom: 340px; right: 20px; width: 50px; height: 50px; border-radius: 50%; font-size: 28px; font-weight: bold; font-style: italic; padding: 0; display: flex; justify-content: center; align-items: center; }
/*#floatingPillageBtn        { bottom: 40px;  left: 20px; } 
/*#floatingBuildBtn          { bottom: 100px;  left: 20px; }
/*#floatingSplitBtn          { bottom: 160px;  left: 20px; }
/*#floatingReinforceBtn      { bottom: 220px; left: 20px; }
/*#floatingUndoMoveBtn       { bottom: 280px; left: 20px; }
/*#floatingConsolidateBtn    { bottom: 320px; left: 20px; display: none; } 
/*#floatingAssignGeneralBtn  { bottom: 380px; left: 20px; display: none;}
/*#floatingNextUnitBtn       { bottom: 440px; left: 20px; display: none; }
/*#floatingManageBtn         { bottom: 320px; left: 20px; display: none; }
/*#floatingInboxBtn          { bottom: 400px; right: 20px; width: 50px; height: 50px; border-radius: 50%; font-size: 28px; padding: 0; display: flex; justify-content: center; align-items: center; }

/* --- Estados Deshabilitados --- */
.floating-btn:disabled, #floatingUndoMoveBtn:disabled, #floatingReinforceBtn:disabled, #floatingSplitBtn:disabled, #floatingBuildBtn:disabled {
    background-color: #6c757d !important; opacity: 0.5;
    cursor: not-allowed; transform: scale(1) !important;
}
#floatingEndTurnBtn:disabled {
    background-color: #6c757d !important; opacity: 0.5;
    cursor: not-allowed; transform: scale(1) !important;
}

/* ========================================================================== */
/* 6.1 BOTONES FLOTANTES (ESTRUCTURA SEPARADA: FIJOS Y MENÚ)                */
/* ========================================================================== */

/* --- 1. CONTENEDOR MAESTRO DE LA UI TÁCTICA --- */
#tactical-ui-container {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none; /* No intercepta clics */
    z-index: 1001;
}

/* --- 2. BASE COMÚN PARA TODOS LOS GRUPOS (IZQUIERDA Y DERECHA) --- */
.floating-action-group {
    position: fixed;
    display: flex;
    gap: 15px;
    pointer-events: all; /* Permite clics en el área del grupo */
}

/* --- 3. ESTILOS PARA TODOS LOS BOTONES --- */
.floating-action-group button {
    position: relative;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: 1px solid #7f8c8d;
    background-color: rgba(44, 62, 80, 0.9);
    color: #ecf0f1;
    font-size: 24px;
    cursor: pointer;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    flex-shrink: 0;
}
.floating-action-group button:hover:not(:disabled) {
    background-color: #34495e;
    transform: scale(1.1);
}
.floating-action-group button:disabled {
    background-color: #6c757d !important;
    opacity: 0.5;
    cursor: not-allowed;
    transform: none !important;
}

/* --- 4. POSICIONAMIENTO Y DIRECCIÓN DE CADA GRUPO --- */

/* Grupo Izquierda */
.floating-action-group.left {
    bottom: 20px;
    left: 15px;
    flex-direction: column-reverse; /* Apila de abajo a arriba */
    align-items: flex-start;
}

/* Grupo Derecha (Contenedor maestro) */
.floating-action-group.right {
    bottom: 20px;
    right: 15px;
    flex-direction: column; /* Apila sus hijos (menú, », ►) de arriba a abajo */
    align-items: flex-end;
}

/* --- 5. LÓGICA DEL SUBMENÚ ⚙️ DE LA DERECHA --- */

.right-menu-group {
    position: relative; /* Contexto para el submenú */
    display: flex;
    flex-direction: column-reverse; /* El submenú sale hacia ARRIBA del botón ⚙️ */
    align-items: flex-end;
    gap: 15px;
}

.submenu {
    display: flex;
    flex-direction: row-reverse; /* Botones se despliegan de derecha a izquierda */
    gap: 15px;
    max-width: 0;
    overflow: hidden;
    opacity: 0;
    transition: all 0.3s ease-out;
    pointer-events: none;
}

/* Lógica de apertura (ahora con el padre correcto) */
.right-menu-group.is-open .submenu {
    max-width: 500px;
    opacity: 1;
    pointer-events: all;
}

/* --- 6. ESTILOS FINALES PARA LOS BOTONES DE LA DERECHA --- */
#floatingEndTurnBtn {
    width: 40px;
    height: 40px;
    font-size: 32px;
    background-color: rgba(40, 167, 69, 0.9);
}

#floatingNextUnitBtn {
    display: none;
}

/* ========================================================================== */
/* 5. PANELES DE UI y DISEÑO ADAPTABLE (REVISIÓN MÓVIL)
/* ========================================================================== */

/* --- Panel de Predicción de Combate --- */
#combatPredictionPanel {
    position: fixed;
    background-color: rgba(20, 20, 20, 0.9);
    color: #f0f0f0;
    padding: 10px 15px;
    border: 1px solid #555;
    border-radius: 8px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    font-size: 0.9em;
    z-index: 10001;
    pointer-events: none;
    white-space: nowrap;
    box-shadow: 0 4px 8px rgba(0,0,0,0.4);
    transition: opacity 0.1s linear;
    opacity: 0;
}
#combatPredictionPanel.visible { opacity: 1; }
#combatPredictionPanel h4 {
    margin: 0 0 8px 0;
    color: #f39c12;
    font-size: 1.1em;
    text-align: center;
    border-bottom: 1px solid #444;
    padding-bottom: 5px;
}
#combatPredictionPanel p { margin: 5px 0; line-height: 1.4; }
#combatPredictionPanel span.attacker-damage { color: #e74c3c; font-weight: bold; }
#combatPredictionPanel span.defender-damage { color: #3498db; font-weight: bold; }
#combatPredictionPanel span.critical-info { color: #f1c40f; font-weight: bold; display: block; text-align: center; margin-top: 8px; }

/* --- Panel de Menú Flotante --- */
#floatingMenuPanel {
    position: fixed; z-index: 9999;
    background-color: rgba(245, 245, 245, 0.95);
    border: 1px solid #ccc;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    padding: 15px;
    transition: transform 0.3s ease-out, opacity 0.3s ease-out;
    display: none;
    top: 70px; left: 10px; width: 260px;
}
#floatingMenuPanel h4 { text-align: center; margin-top: 0; margin-bottom: 10px; font-size: 1em; color: #333; }
#floatingMenuPanel #playerResourcesGrid_float {
    display: grid; grid-template-columns: repeat(7, 1fr); grid-template-rows: auto auto;
    gap: 4px 2px; padding: 8px; margin-bottom: 10px; background-color: #f8f9fa;
    border: 1px solid #e0e0e0; border-radius: 4px; text-align: center;
    font-size: 0.85em;
}
#floatingMenuPanel button, #floatingMenuPanel .button-like-label {
    width: 100%; display: block; margin-bottom: 8px; padding: 10px;
    text-align: left; background-color: #e9ecef; color: #333; border: 1px solid #ddd;
}
#floatingMenuPanel button:hover, #floatingMenuPanel .button-like-label:hover { background-color: #dee2e6; }
#floatingMenuPanel .resource-labels { grid-row: 1; grid-column: 1 / -1; display: contents; }
#floatingMenuPanel .resource-values { grid-row: 2; grid-column: 1 / -1; display: contents; }
#floatingMenuPanel .resource-labels span { font-size: 0.8em; font-weight: 500; color: #6c757d; }
#floatingMenuPanel .resource-values span { font-size: 0.9em; font-weight: bold; color: #212529; }

/* --- Paneles Inferiores (Contextual y Tutorial) - REGLA PRINCIPAL --- */
#contextualInfoPanel,
.tutorial-panel {
    position: fixed;
    bottom: 10px;
    left: 50%;
    
    width: 90vw;
    max-width: 450px;
    box-sizing: border-box;
    transform: translateX(-50%);

    background-color: rgba(10, 20, 30, 0.85);
    color: #cbd5e0;
    border: 1px solid rgba(135, 118, 70, 0.7);
    border-radius: 8px;
    padding: 8px 15px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.5);
    
    font-size: 0.85em;
    line-height: 1.6;
    
    pointer-events: none;
    z-index: 10000; /* Capa alta */
    
    opacity: 0;
    transition: opacity 0.3s ease, transform 0.3s ease;
}

#contextualInfoPanel.visible,
.tutorial-panel.visible {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
}

#contextualInfoPanel #closeContextualPanelBtn,
.tutorial-panel #closeTutorialPanelBtn {
    position: absolute;
    top: -8px;
    right: -8px;
    width: 28px;
    height: 28px;
    background-color: #c0392b;
    color: white;
    border: 2px solid white;
    border-radius: 50%;
    font-size: 16px;
    line-height: 24px;
    text-align: center;
    cursor: pointer;
    z-index: 10001; 
    pointer-events: auto !important; 
}

#reopenContextualPanelBtn {
    position: fixed;
    bottom: 10px;
     /* --- INICIO DEL CAMBIO --- */
    left: 50%; /* Lo mueve al centro horizontal */
    transform: translateX(-50%); /* Ajusta el centrado perfectamente */
    /* --- FIN DEL CAMBIO --- */
    width: 30px;
    height: 30px;
    background-color: rgba(30, 42, 56, 0.9);
    color: #e2e8f0;
    border: 1px solid #4a5568;
    border-radius: 5px;
    z-index: 999;
    cursor: pointer;
}

/* --- Panel de Turno del Oponente --- */
.turn-blocker {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 5000;
    display: flex; justify-content: center; align-items: center;
    font-size: 2.5em; color: white; text-shadow: 2px 2px 4px black;
    text-align: center; cursor: not-allowed;
}

/* --- REGLAS PARA PANTALLAS PEQUEÑAS (MÓVILES Y TABLETS) --- */
@media screen and (max-width: 768px) {
    
    /* MODALES: Se hacen adaptables y ocupan casi toda la pantalla */
    .modal-content {
        width: 95vw !important;
        max-width: 95vw !important;
        max-height: 85vh !important;
        overflow-y: auto; /* AÑADE SCROLL SI EL CONTENIDO ES MUY LARGO */
        padding: 15px;
    }
    
    /* MODAL DE HÉROE: Pasa de 3 columnas a 1 para que quepa en vertical */
    .hero-main-layout {
        grid-template-columns: 1fr; /* Una sola columna */
        gap: 15px;
    }
    .hero-main-layout .hero-column { padding: 10px; }
    
    /* MENÚ DERECHO: Hacemos que el submenú sea scrolleable si no cabe */
    .submenu {
        /* Restringe su altura máxima a un 50% de la pantalla y permite scroll */
        max-height: 50vh !important;
        overflow-y: auto !important;
    }
    .floating-action-group.right.is-open .submenu {
        /* Se expande a esa altura máxima */
        max-height: 50vh !important;
    }
    
    /* WIKI: Las pestañas se apilan si no caben en una línea */
    .wiki-tabs { flex-wrap: wrap; }
    .wiki-tab-btn { font-size: 0.8em; padding: 8px 10px; }
}

/* ========================================================================== */
/* 7. MODALES (base y específicos)
/* ========================================================================== */

/* --- Modal Base --- */
.modal {
    display: none; position: fixed; z-index: 1000; left: 0; top: 0;
    width: 100%; height: 100%; overflow: auto;
    background-color: rgba(0,0,0,0.5);
    align-items: center; justify-content: center;
}
.modal-content {
    background-color: #fefefe; padding: 20px; border: 1px solid #888;
    width: 90%; max-width: 600px; border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}
.close-button {
    color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer;
}
.close-button:hover, .close-button:focus { color: black; }
/** DUPLICADO: .close-button más específico para modales */
.modal .close-button {
    color: #aaa; position: absolute; top: 10px; right: 15px;
    font-size: 28px; font-weight: bold; cursor: pointer; line-height: 1;
}

/* --- Modal: Menú Principal --- */
#mainMenuScreen.modal {
    background-color: transparent;
}

/* Elimina el fondo, borde y sombra de la caja de contenido. */
#mainMenuScreen .modal-content {
    width: 90%; /* Ocupa el 90% del ancho de la pantalla */
    background-color: transparent;
    border: none;
    box-shadow: none;
}

/* Oculta el título "Hex General Evolved" */
#mainMenuScreen h2 {
    display: none;
}

/* Estiliza los botones para que se vean bien sobre la imagen de fondo. */
#mainMenuScreen button {
    background-color: rgba(0, 0, 0, 0.6); /* Fondo negro semi-transparente */
    color: #f0e6d2; /* Color de texto tipo pergamino, más cálido que el blanco puro */
    border: 1px solid rgba(255, 215, 0, 0.5); /* Borde sutil dorado/bronce */
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7); /* Sombra de texto para máxima legibilidad */
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    font-size: 1.2em; /* Un poco más grande para darle epicidad */
    transition: all 0.2s ease-in-out; /* Transición suave para todos los efectos */
}

/* Efecto al pasar el ratón por encima del botón. */
#mainMenuScreen button:hover,
#mainMenuScreen button:active {
    background-color: rgba(20, 20, 20, 0.8); /* Se oscurece un poco */
    border-color: rgba(255, 215, 0, 0.9); /* El borde se vuelve más brillante */
    transform: translateY(-3px) scale(1.02); /* Se eleva y agranda ligeramente */
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
}

/* Mantenemos el estilo del botón de "Unirse a Partida" para que destaque */
#mainMenuScreen button#joinNetworkGameBtn {
    background-color: rgba(255, 193, 7, 0.7); /* Amarillo semi-transparente */
    color: #111;
    border-color: rgba(255, 255, 255, 0.6);
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

#mainMenuScreen button#joinNetworkGameBtn:hover {
    background-color: rgba(255, 193, 7, 0.9);
}

/* --- Modal: Detalles del Héroe --- */
#heroDetailModal .modal-content {    max-width: 600px;    background-color: #f0f2f5;}
.hero-detail-header {
    display: flex;
    align-items: center;
    border-bottom: 2px solid #ccc;
    padding-bottom: 15px;
    margin-bottom: 15px;
}
.hero-detail-header .hero-sprite {
    font-size: 80px;
    margin-right: 20px;
    line-height: 1;
}
.hero-header-info h2 { margin: 0 0 5px 0; }
.hero-header-info p { margin: 0; font-style: italic; color: #6c757d; }
.hero-header-info .hero-rarity {
    margin-top: 8px;
    font-weight: bold;
    padding: 3px 8px;
    border-radius: 4px;
    display: inline-block;
}
.hero-rarity.Común { background-color: #adb5bd; color: white; }
.hero-rarity.Raro { background-color: #007bff; color: white; }
.hero-rarity.Épico { background-color: #8a2be2; color: white; }
.hero-rarity.Legendario { background-color: #ffc107; color: #333; }

.hero-detail-body {
    display: flex;
    gap: 20px;
}
.hero-progression-section, .hero-skills-section {
    flex: 1;
}
.hero-progression-section h4, .hero-skills-section h4 {
    margin-top: 0;
    margin-bottom: 10px;
    border-bottom: 1px solid #ddd;
    padding-bottom: 5px;
}
.progress-item {
    margin-bottom: 15px;
    font-size: 0.9em;
}
.progress-item > span {
    display: block;
    margin-bottom: 5px;
}
.xp-bar-container {
    width: 100%;
    background-color: #ced4da;
    border-radius: 8px;
    height: 16px;
    overflow: hidden;
}
.xp-bar {
    height: 100%;
    width: 0%; /* Se actualizará con JS */
    background-color: #28a745;
    border-radius: 8px;
    transition: width 0.3s ease;
}
.xp-bar.fragments {
    background-color: #007bff;
}

.skill-item {
    margin-bottom: 10px;
}
.skill-item h5 {
    margin: 0 0 3px 0;
    color: #0056b3;
}
.skill-item p {
    margin: 0;
    font-size: 0.85em;
    color: #495057;
}
.skill-item.active-skill h5::before {
    content: 'ACTIVA | ';
    color: #dc3545;
    font-weight: bold;
}

.hero-detail-footer {
    margin-top: 20px;
    padding-top: 15px;
    border-top: 2px solid #ccc;
    text-align: right;
}
.hero-detail-footer button {
    padding: 8px 16px;
    margin-left: 10px;
}
.hero-detail-footer button:disabled {
    background-color: #6c757d;
    cursor: not-allowed;
    opacity: 0.6;
}


/* --- Modal: Configuración de Escaramuza y Campaña --- */
#setupScreen .modal-content { background-color: #fff; border: 1px solid #ddd; }
#setupScreen div { margin-bottom: 15px; }
#setupScreen label { display: inline-block; width: 130px; font-weight: 500; }
#setupScreen select { padding: 8px; border-radius: 4px; border: 1px solid #ccc; min-width: 150px; }
#setupScreen button { padding: 10px 20px; font-size: 1em; }
#backToMainMenuBtn_fromCampaign, #backToMainMenuBtn_fromSetup {
    background-color: #6c757d; color: white; border: none; border-radius: 4px;
    cursor: pointer; padding: 8px 15px; font-size: 0.9em; margin-top: 10px;
}
#backToMainMenuBtn_fromCampaign:hover, #backToMainMenuBtn_fromSetup:hover { background-color: #5a6268; }
#worldMapScreen { background-color: #7da0c0; box-shadow: 0 0 15px rgba(0,0,0,0.3); border-radius: 8px; position: relative; }
#worldMapImage { border-radius: 6px; display: block; max-width: 100%; height: auto; }
#campaignMessages { border-top: 1px solid #ccc; color: #333; max-width: 300px; word-wrap: break-word; padding: 10px; margin-top: 10px; background-color: #f9f9f9; border-radius: 4px; }
.territory-on-map {
    position: absolute; width: auto; min-width: 30px; height: auto; padding: 5px 8px;
    background-color: rgba(220, 220, 220, 0.8); border: 1px solid #777; color: #333;
    border-radius: 20px; display: flex; justify-content: center; align-items: center;
    font-size: 0.75em; font-weight: bold; text-align: center; cursor: default; pointer-events: all;
    transform: translate(-50%, -50%); transition: background-color 0.2s, transform 0.2s, box-shadow 0.2s;
    box-shadow: 0 1px 2px rgba(0,0,0,0.2);
}
.territory-on-map.player-controlled { background-color: rgba(60, 179, 113, 0.85); border-color: #2e8b57; color: white; }
.territory-on-map.ai-controlled { background-color: rgba(220, 20, 60, 0.85); border-color: #b22222; color: white; }
.territory-on-map.neutral-territory { background-color: rgba(240, 230, 140, 0.85); border-color: #b8860b; color: #545454; }
.territory-on-map.selectable-territory { cursor: pointer; border-width: 2px; }
.territory-on-map.selectable-territory:hover { transform: translate(-50%, -50%) scale(1.1); box-shadow: 0 0 12px 4px gold; z-index: 10; }

/* --- Modal: Briefing de Escenario --- */
#scenarioBriefingModal .modal-content { text-align: left; max-height: 90vh; overflow-y: auto; }
#scenarioBriefingModal #scenarioTitle { color: #0056b3; margin-bottom: 10px; }
#scenarioBriefingModal #scenarioImage { border: 1px solid #eee; max-width: 100%; height: auto; display: block; margin: 10px auto; border-radius: 4px; }
#scenarioBriefingModal #startScenarioBattleBtn { background-color: #28a745; color: white; display: block; margin: 20px auto 0 auto; padding: 10px 20px; }
#scenarioBriefingModal #startScenarioBattleBtn:hover { background-color: #1e7e34; }

/* --- Modal: Árbol de Tecnología --- */
.tech-tree-content .tech-node {
    position: absolute; width: 100px; height: 100px; background-color: #2a9d8f;
    color: white; border-radius: 50%; display: flex; flex-direction: column;
    align-items: center; justify-content: center; text-align: center;
    border: 3px solid #264653; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;
    padding: 5px; box-sizing: border-box; font-size: 0.8em;
}
.tech-tree-content .tech-node:hover { transform: scale(1.05); box-shadow: 0 0 15px #f4a261; }
.tech-tree-content .tech-node img { width: 40px; height: 40px; margin-bottom: 5px; }
.tech-tree-content .tech-node.researched { background-color: #e9c46a; border-color: #f4a261; }
.tech-tree-content .tech-node.available { background-color: #2a9d8f; border-color: #264653; box-shadow: 0 0 10px 3px #aaf0d1; }
.tech-tree-content .tech-node.locked { background-color: #6c757d; opacity: 0.7; cursor: not-allowed; }

/* ========================================================== */
/* ==   NUEVOS ESTILOS COMPLETOS PARA TALENTOS (V2)        == */
/* ========================================================== */

/* --- Contenedor Principal del Modal Grande --- */
#talentTreeModal .modal-content.talent-tree-modal-content {
    width: 90vw;
    max-width: 1400px;
    height: 85vh;
    background-color: #2c3e50; /* Un azul-gris oscuro */
    color: #ecf0f1;
    display: flex;
    flex-direction: column;
    padding: 15px;
    border: 2px solid #95a5a6;
    box-shadow: 0 0 30px rgba(0,0,0,0.5);
}

.talent-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #7f8c8d;
    padding-bottom: 10px;
    margin-bottom: 10px;
    flex-shrink: 0;
}
.talent-points-counter {
    font-size: 1.2em;
    font-weight: bold;
    color: #f1c40f; /* Dorado */
}
#resetTalentsBtn {
    background-color: #c0392b; /* Rojo */
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 5px;
    cursor: pointer;
}

/* --- El Viewport Scrollable --- */
#talentCanvasContainer {
    position: relative;
    flex-grow: 1; /* Ocupa todo el espacio disponible */
    overflow: auto; /* ¡LA CLAVE! Permite el scroll */
    background-color: #34495e;
    border-radius: 8px;
    border: 1px solid #7f8c8d;
}

/* --- El Lienzo Gigante donde se dibuja TODO --- */
/* --- El Lienzo Gigante donde se dibuja TODO (TAMAÑO CORREGIDO) --- */
.talent-tree-canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 1500px;  /* TU TAMAÑO */
    height: 1500px; /* TU TAMAÑO */
}

/* --- El Nexo Central (POSICIÓN CORREGIDA) --- */
#talentNexoContainer {
    position: absolute;
    top: 950px;    /* TU COORDENADA Y */
    left: 750px;   /* TU COORDENADA X */
    transform: translate(-50%, -50%);
    width: 180px;
    height: 180px;
    z-index: 100;
    border-radius: 50%;
    background: #1f2b38;
    box-shadow: 0 0 20px rgba(0,0,0,0.7);
    border: 4px solid #7f8c8d;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    font-weight: bold;
    color: #ecf0f1;
}

/* --- Las Líneas de Conexión SVG --- */
.talent-svg-lines {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1; /* Por debajo de los nodos */
}

#talentNexoContainer .nexo-pie {
    /* Los "pies" ahora son simples divs dentro del círculo, más fáciles de manejar */
    position: absolute;
    width: 100px;
    height: 100px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s;
    cursor: pointer;
    border: none;
}
#talentNexoContainer .nexo-pie:hover {
    transform: scale(1.1);
}
/* Posicionamiento simple usando translate */
.nexo-pie:nth-child(1) { transform: translate(-60%, 45%); } /* Izquierda-Abajo, más centrado */
.nexo-pie:nth-child(2) { transform: translateY(-65%); }    /* Arriba, más centrado */
.nexo-pie:nth-child(3) { transform: translate(60%, 45%); }  /* Derecha-Abajo, más centrado */

.nexo-icon { font-size: 2.2em; line-height: 1; }
.nexo-name { font-size: 0.9em; margin-top: 5px; }


/* --- Nodos de Talento Individuales --- */
.talent-node {
    position: absolute;
    color: white;
    background-color: #4a5568; /* Gris oscuro */
    border: 3px solid #718096; /* Borde gris más claro */
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: not-allowed;
    transition: transform 0.2s, box-shadow 0.2s;
    font-size: 1.2em; /* Icono más grande */
    padding: 5px;
    box-sizing: border-box;
}
/* Formas de los nodos */
.talent-node.square { width: 50px; height: 50px; border-radius: 8px; }
.talent-node.circle { width: 45px; height: 45px; border-radius: 50%; }

/* Estados de los nodos */
.talent-node.available {
    background-color: #2980b9; /* Azul */
    border-color: #3498db;
    cursor: pointer;
    box-shadow: 0 0 15px rgba(52, 152, 219, 0.5);
}
.talent-node.maxed {
    background-color: #d69e2e; /* Dorado */
    border-color: #f1c40f;
    cursor: help;
}
.talent-node.available:hover {
    transform: translate(-50%, -50%) scale(1.1); /* Importante para no perder el centrado */
    box-shadow: 0 0 20px rgba(52, 152, 219, 0.9);
}

/* Nivel del talento */
.talent-node-level {
    position: absolute;
    bottom: -10px;
    right: -10px;
    font-weight: bold;
    font-size: 0.7em;
    background-color: rgba(0,0,0,0.8);
    color: #f1c40f; /* Dorado */
    border-radius: 50%;
    width: 24px;
    height: 24px;
    line-height: 24px;
    text-align: center;
    border: 1px solid #f1c40f;
}

/*===============================================================*/
/* --- Estilos para la Columna de Equipo (Diseño de Cuerpo) --- */
/*=============================================================*/
.equipment-layout {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px; /* Espacio entre filas */
    padding-top: 15px;
}

.equip-row-single {
    display: flex;
    justify-content: center;
}

.equipment-slot {
    height: 75px;
    background-color: #e9ecef;
    border: 2px dashed #adb5bd;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background-color 0.2s, border-color 0.2s;
    position: relative; /* Para futuros iconos de objetos */
}

.equipment-slot:hover {
    background-color: #dde2e6;
    border-color: #007bff;
}

.equipment-slot span {
    color: #6c757d;
    font-size: 0.8em;
    font-weight: 500;
}

/* --- Posicionamiento específico dentro de la rejilla central 2x2 --- */
/* --- Reemplaza esta sección en tu CSS --- */

.equip-row-middle {
    display: grid;
    /* Creamos una rejilla imaginaria de 2 columnas y 3 filas */
    grid-template-columns: 1fr 1fr;
    grid-template-rows: auto auto auto;
    gap: 10px;
    width: 100%;
    align-items: center; /* Centra los items verticalmente en sus filas */
}

/* --- Posicionamiento EXACTO para formar el rombo --- */

/* La Coraza ocupa las 2 columnas de la primera fila */
#equip-chest { 
    grid-column: 1 / span 2; 
    grid-row: 1;
    justify-self: center; /* Se centra horizontalmente en su área */
    width: 50%; /* Hacemos que sea más estrecho para formar el pico del rombo */
}

/* Los Guantes en la primera columna de la segunda fila */
#equip-gloves {
    grid-column: 1;
    grid-row: 2;
}

/* El Arma en la segunda columna de la segunda fila */
#equip-weapon {
    grid-column: 2;
    grid-row: 2;
}

/* El Pantalón ocupa las 2 columnas de la tercera fila */
#equip-legs {
    grid-column: 1 / span 2;
    grid-row: 3;
    justify-self: center; /* Se centra horizontalmente */
    width: 50%; /* También más estrecho para la base del rombo */
}

/* --- Estilos para el Pie de Página del Modal de Héroe --- */
.hero-detail-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid #dee2e6;
}

.talent-button {
    background-color: #007bff;
    color: white;
    font-weight: bold;
    font-size: 1.1em;
    padding: 12px 24px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}
.talent-button:hover {
    background-color: #0056b3;
}
.upgrade-buttons button {
    margin-left: 10px;
    padding: 10px 20px;
}

/* --- Estilos para el Modal de Árbol de Talentos (Pantalla Grande) --- */
.talent-tree-modal-content {
    width: 90vw;
    max-width: 1200px;
    height: 85vh;
    background-color: #34495e;
    color: #ecf0f1;
    display: flex;
    flex-direction: column;
    padding: 20px;
}
.talent-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #7f8c8d;
    padding-bottom: 15px;
    margin-bottom: 15px;
}
.talent-points-counter {
    font-size: 1.2em;
    font-weight: bold;
}
#resetTalentsBtn {
    background-color: #e74c3c;
    color: white;
}

/* Reutilizamos los estilos de .tabs y .tab-button que ya tenías */
#talentTreeTabs {
    border-bottom: 2px solid #95a5a6;
}
#talentTreeTabs .tab-button.active {
    color: #f1c40f;
    border-bottom-color: #f1c40f;
}

/* Renombramos tu .talent-tree-container para ser más específico */
#talentTreeContainer {
    flex-grow: 1; /* Ocupa el espacio restante */
    position: relative; /* Clave para el posicionamiento absoluto de los nodos */
    overflow: auto;
    background-color: #2c3e50;
    border-radius: 5px;
    margin-top: 10px;
}

/* ========================================================== */
/* ==   NUEVO: ESTILOS PARA SELECCIÓN DE EQUIPO             == */
/* ========================================================== */

/* Indicador visual en el slot del héroe si hay mejoras disponibles */
.equipment-slot.available-upgrade {
    border-style: solid;
    border-color: #28a745; /* Verde brillante */
    background-color: #e9f7ef;
    animation: pulse-green 1.5s infinite;
}

@keyframes pulse-green {
    0% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); }
    70% { box-shadow: 0 0 0 10px rgba(40, 167, 69, 0); }
    100% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
}

/* Contenedor de la lista en el modal de selección */
.equipment-list {
    max-height: 50vh;
    overflow-y: auto;
    border: 1px solid #ddd;
    border-radius: 5px;
    margin-top: 15px;
    background-color: #f8f9fa;
}

/* Cada item en la lista de selección */
.equipment-item {
    display: flex;
    align-items: center;
    padding: 12px;
    cursor: pointer;
    border-bottom: 1px solid #eee;
    transition: background-color 0.2s;
}

.equipment-item:last-child {
    border-bottom: none;
}

.equipment-item:hover {
    background-color: #e9ecef;
}

.equipment-item.selected {
    background-color: #d4edda; /* Verde claro para el seleccionado */
    border-left: 4px solid #28a745;
}

.equipment-item .item-icon {
    font-size: 2.5em;
    margin-right: 15px;
    width: 40px;
    text-align: center;
}

.equipment-item .item-info {
    display: flex;
    flex-direction: column;
}

.equipment-item .item-name {
    font-weight: bold;
    font-size: 1.1em;
    margin-bottom: 4px;
}

/* Colores para el nombre del item según su rareza */
.rarity-Común { color: #6c757d; }
.rarity-Raro { color: #007bff; }
.rarity-Épico { color: #8a2be2; }
.rarity-Legendario { color: #fd7e14; }

.equipment-item .item-stats {
    font-size: 0.9em;
    color: #495057;
}

/* ========================================================== */
/* --- Modales: Gestión de Unidades --- */
/* ========================================================== */
/* Listas genéricas en modales */
#availableRegimentsList li, #currentDivisionRegimentsList li, #availableStructuresList li {
    cursor: pointer; padding: 8px; border-bottom: 1px solid #eee; transition: background-color 0.2s;
}
#availableRegimentsList li:hover, #currentDivisionRegimentsList li:hover, #availableStructuresList li:hover { background-color: #f0f0f0; }
#availableStructuresList li.selected-structure { background-color: #d0e0ff; font-weight: bold; }

/* Panel de edición de nombre */
#unit-info .unit-name-editor { display: flex; align-items: center; margin-bottom: 8px; }
#unit-info .unit-name-editor label { margin-right: 5px; font-weight: bold; }
#unit-info #selectedUnitNameInput { flex-grow: 1; padding: 5px; border: 1px solid #ccc; border-radius: 3px; margin-right: 5px; background-color: #f8f9fa; }
#unit-info #selectedUnitNameInput:not([readonly]) { background-color: #fff; border-color: #007bff; }
#unit-info .unit-name-editor button { padding: 4px 8px; font-size: 0.9em; background-color: #e9ecef; border: 1px solid #ced4da; border-radius: 3px; cursor: pointer; }
#unit-info .unit-name-editor button:hover { background-color: #dee2e6; }
#unit-info #saveUnitNameBtn { background-color: #28a745; color: white; }
#unit-info #saveUnitNameBtn:hover { background-color: #218838; }

/* Lista detallada de regimientos */
.regiments-detailed-list { list-style: none; padding: 0; margin: 0; font-size: 0.8em; max-height: 150px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 3px; background-color: #fdfdfd; }
.regiments-detailed-list li { padding: 6px 8px; border-bottom: 1px dashed #eee; }
.regiments-detailed-list li:last-child { border-bottom: none; }
.regiments-detailed-list li strong { color: #0056b3; }

/* Modal de División Avanzada */
#advancedSplitUnitModal .modal-content { max-width: 450px; padding: 15px; }
#advancedSplitUnitModal h3 { font-size: 1.1em; margin-bottom: 5px; }
#advancedSplitUnitModal > p { font-size: 0.8em; margin-bottom: 10px; }
.split-regiment-container { display: flex; gap: 10px; margin-top: 10px; flex-wrap: nowrap; }
.regiment-column { flex: 1; min-width: 0; padding: 8px; border: 1px solid #ddd; border-radius: 5px; background-color: #fff; display: flex; flex-direction: column; }
.regiment-column h4 { font-size: 1em; margin-top: 0; margin-bottom: 5px; padding-bottom: 4px; border-bottom: 1px solid #eee; text-align: center; }
.regiment-column p { font-size: 0.8em; margin: 2px 0; text-align: center; }
#newSplitUnitNameInput { padding: 4px; font-size: 0.9em; width: 100%; box-sizing: border-box; }
.regiments-list { list-style: none; padding: 0; margin: 5px 0 0 0; max-height: 200px; overflow-y: auto; border: 1px solid #91c5fa; border-radius: 3px; flex-grow: 1; }
.regiments-list li { padding: 6px 8px; font-size: 1.5em; display: flex; justify-content: space-between; align-items: center; cursor: pointer; border-bottom: 1px solid #eee; }
.regiments-list li:last-child { border-bottom: none; }
.regiments-list li:hover { background-color: #e9f7ff; }
.regiments-list li span.regiment-type { font-weight: bold; color: #007bff; margin-left: 5px; }
.regiments-list li span.regiment-actions { font-size: 0.8em; color: #007bff; }
#advancedSplitUnitModal .modal-footer-actions { margin-top: 15px; }
#advancedSplitUnitModal button { padding: 8px 16px; font-size: 0.9em; }
#advancedSplitUnitModal button:hover { background-color: #0056b3; }
#advancedSplitUnitModal button:disabled { background-color: #ccc; cursor: not-allowed; }
#advancedSplitUnitModal button#finalizeSplitBtn { background-color: #28a745; }
#advancedSplitUnitModal button#finalizeSplitBtn:hover { background-color: #218838; }
#advancedSplitUnitModal button#cancelAdvancedSplitBtn { background-color: #6c757d; }
#advancedSplitUnitModal button#cancelAdvancedSplitBtn:hover { background-color: #5a6268; }

/* Modal de Gestión General de Unidades */
.unit-management-content {
    width: 90%; max-width: 800px; background-color: #f0f2f5; padding: 20px;
    border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    display: flex; flex-direction: column;
}
.unit-management-content h3 { text-align: center; color: #333; margin-top: 0; margin-bottom: 20px; }
.unit-management-body { display: flex; gap: 20px; flex-grow: 1; min-height: 400px; }
.unit-selection-panel { flex: 2; display: flex; flex-direction: column; border: 1px solid #ccc; border-radius: 5px; background-color: #fff; }
.category-tabs { display: flex; border-bottom: 1px solid #ccc; padding: 5px; background-color: #e9ecef; }
.category-tabs .tab-btn { flex-grow: 1; padding: 10px 5px; background-color: transparent; border: none; border-radius: 3px; cursor: pointer; font-weight: 500; color: #495057; transition: background-color 0.2s; }
.category-tabs .tab-btn:hover { background-color: #dee2e6; }
.category-tabs .tab-btn.active { background-color: #007bff; color: white; }
.available-units-list { padding: 10px; overflow-y: auto; flex-grow: 1; }
.unit-entry { display: flex; justify-content: space-between; align-items: center; padding: 8px 5px; border-bottom: 1px solid #eee; }
.unit-entry:last-child { border-bottom: none; }
.unit-entry span { font-weight: 500; }
.quantity-controls { display: flex; align-items: center; }
.quantity-controls .quantity-btn { width: 28px; height: 28px; border: 1px solid #ccc; background-color: #f8f9fa; font-size: 1.2em; cursor: pointer; line-height: 1; }
.quantity-controls .quantity-input { width: 40px; text-align: center; border: 1px solid #ccc; border-left: none; border-right: none; height: 26px; -moz-appearance: textfield; }
.quantity-controls .quantity-input::-webkit-outer-spin-button, .quantity-controls .quantity-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
.division-summary-panel { flex: 1; padding: 15px; background-color: #ffffff; border: 1px solid #ddd; border-radius: 5px; display: flex; flex-direction: column; }
.division-summary-panel h4 { margin-top: 0; text-align: center; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px; }
.division-name-editor { margin-bottom: 15px; }
.division-name-editor input { width: 100%; padding: 8px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
#divisionCompositionList { list-style: none; padding: 0; margin: 0; flex-grow: 1; overflow-y: auto; }
#divisionCompositionList li { padding: 5px 0; }
.summary-details { border-top: 1px solid #eee; padding-top: 10px; margin-top: auto; font-size: 0.9em; }
.summary-details p { margin: 5px 0; }
.modal-footer-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }
.modal-footer-actions button { padding: 10px 20px; border-radius: 5px; border: none; font-weight: bold; cursor: pointer; }
#finalizeUnitManagementBtn { background-color: #28a745; color: white; }
#finalizeUnitManagementBtn:disabled { background-color: #94dcb0; cursor: not-allowed; }

/* Modal de Detalles de Unidad (Rediseñado) */
#unitDetailModal .unit-detail-content, #unitDetailModal .modal-content { max-width: 400px; width: 90%; background-color: #e9ecef; padding: 15px; }
#unitDetailModal h3 { text-align: center; margin-top: 0; margin-bottom: 15px; font-size: 1.2em; }
.unit-main-stats { background-color: #fff; padding: 10px; border-radius: 5px; border: 1px solid #ccc; margin-bottom: 15px; }
.stat-row { display: flex; justify-content: space-between; align-items: center; font-size: 0.9em; padding: 4px 0; }
.stat-row.stat-summary span { font-weight: bold; }
.stat-row .stat-label { font-weight: bold; margin-right: 10px; }
.unit-total-health-bar-container { flex-grow: 1; height: 18px; background-color: #ced4da; border-radius: 9px; border: 1px solid #adb5bd; }
.unit-total-health-bar { height: 100%; background-color: #28a745; border-radius: 9px; transition: width 0.3s ease-out; }
#unitDetailTotalHealthText { margin-left: 10px; font-weight: bold; min-width: 80px; text-align: right; }
.regiment-section-title { text-align: center; font-size: 0.8em; color: #6c757d; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
#unitDetailRegimentList .regiment-detail-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 8px; border-bottom: 1px solid #eee; }
#unitDetailRegimentList .regiment-info { font-weight: 500; }
#unitDetailRegimentList .regiment-health-bar-container { flex-grow: 1; height: 12px; background-color: #e0e0e0; border-radius: 6px; margin: 0 15px; position: relative; }
#unitDetailRegimentList .regiment-health-bar { height: 100%; background-color: #4CAF50; border-radius: 6px; transition: width 0.3s ease; }
#unitDetailRegimentList .regiment-health-text { font-size: 0.8em; min-width: 50px; text-align: right; }
#unitDetailRegimentList .reinforce-btn { padding: 4px 8px; font-size: 1.2em; line-height: 1; margin-left: 10px; cursor: pointer; border: 1px solid #ccc; background-color: #f0f0f0; }
#unitDetailRegimentList .reinforce-btn:hover { background-color: #d4edda; }
#unitDetailRegimentList .reinforce-btn:disabled { opacity: 0.4; cursor: not-allowed; }
.detailed-regiments-list { background-color: #fff; border-radius: 5px; border: 1px solid #ccc; max-height: 250px; overflow-y: auto; padding: 5px !important; margin: 0 !important; }
.detailed-regiments-list .regiment-detail-item { display: flex; align-items: center; padding: 8px; border-bottom: 1px solid #f1f3f5; }
.detailed-regiments-list .regiment-detail-item:last-child { border-bottom: none; }
.regiment-icon { font-size: 1.5em; margin-right: 8px; width: 25px; text-align: center; }
.regiment-name { font-weight: 500; width: 100px; flex-shrink: 0; }
.detailed-regiments-list .regiment-health-bar-container { flex-grow: 1; height: 12px; background-color: #e9ecef; border-radius: 6px; margin: 0 10px; }
.detailed-regiments-list .regiment-health-bar { height: 100%; background-color: #519DE9; border-radius: 6px; transition: width 0.3s ease; }
.detailed-regiments-list .regiment-health-text { font-size: 0.8em; min-width: 60px; text-align: right; }
.reinforce-regiment-btn { background: #e9ecef; border: 1px solid #ced4da; border-radius: 50%; width: 24px; height: 24px; font-size: 1em; line-height: 1; cursor: pointer; margin-left: 10px; transition: background-color 0.2s; }
.reinforce-regiment-btn:hover { background-color: #d4edda; }
.reinforce-placeholder { width: 24px; height: 24px; margin-left: 10px; }

/* ========================================================== */
/* ==   NUEVO: ESTILOS PARA LA FORJA                        == */
/* ========================================================== */

/* Contenedor principal del modal de forja (2 columnas) */
.forge-container {
    display: flex;
    gap: 20px;
    margin-top: 20px;
    height: 60vh;
}

/* Columna Izquierda: Lista de planos */
.blueprint-list {
    flex: 1;
    border: 1px solid #ddd;
    border-radius: 5px;
    overflow-y: auto;
    background-color: #f8f9fa;
}

.blueprint-item {
    display: flex;
    align-items: center;
    padding: 10px;
    cursor: pointer;
    border-bottom: 1px solid #eee;
}

.blueprint-item:hover {
    background-color: #e9ecef;
}

.blueprint-item.selected {
    background-color: #e2e6ea;
    border-left: 4px solid #fd7e14; /* Naranja para la selección */
}

.blueprint-item.can-forge .item-name {
    color: #28a745; /* Verde si se puede forjar */
}

.blueprint-item .item-icon {
    font-size: 2em;
    margin-right: 15px;
}

.blueprint-item .item-info .item-name {
    font-weight: bold;
}

.blueprint-item .item-info .item-progress {
    font-size: 0.9em;
    color: #6c757d;
}

/* Columna Derecha: Detalles del plano */
.blueprint-detail {
    flex: 1;
    padding: 20px;
    border: 1px solid #ddd;
    border-radius: 5px;
    background-color: #fff;
    display: flex;
    flex-direction: column;
}

.item-icon-large {
    font-size: 4em;
    text-align: center;
    margin-bottom: 15px;
}

#blueprintItemName {
    text-align: center;
    margin-top: 0;
}

#blueprintItemStats {
    text-align: center;
    font-style: italic;
    color: #495057;
    min-height: 40px;
}

.forge-progress-item {
    font-size: 0.9em;
}

#forgeItemBtn {
    background-color: #28a745;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

#forgeItemBtn:disabled {
    background-color: #6c757d;
    cursor: not-allowed;
}
/* ========================================================== */
/* --- Modal: Wiki y Ayuda --- */
/* ========================================================== */

.help-modal-content {
    max-width: 700px; max-height: 90vh; overflow-y: auto;
    background-color: #f0f2f5; border: 1px solid #ccc;
    box-shadow: 0 5px 20px rgba(0,0,0,0.15); padding: 30px; position: relative;
}
.help-modal-content h2 { font-size: 2.2em; color: #0056b3; }
.help-modal-content h3 { font-size: 1.4em; color: #4a5568; margin-top: 25px; margin-bottom: 10px; border-bottom: 1px solid #e0e0e0; padding-bottom: 5px; }
.help-modal-content p { font-size: 1em; line-height: 1.5; color: #333; margin-bottom: 15px; }
.help-modal-content b { font-weight: bold; color: #007bff; }
.help-modal-content ul { list-style: disc; margin-left: 20px; margin-bottom: 15px; }
.help-modal-content li { margin-bottom: 5px; }
.help-modal-content button { background-color: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.2s ease-in-out; font-weight: bold; }
.help-modal-content button:hover { background-color: #218838; }
#doNotShowAgainCheckbox { transform: scale(1.2); margin-right: 8px !important; }

.wiki-content {
    width: 95%; max-width: 900px; height: 85vh; display: flex; flex-direction: column; padding: 20px;
}
.wiki-content h2 { text-align: center; margin-top: 0; margin-bottom: 15px; color: #333; }
.wiki-tabs { display: flex; border-bottom: 2px solid #007bff; margin-bottom: 15px; }
.wiki-tab-btn { padding: 10px 15px; cursor: pointer; border: none; background-color: transparent; font-size: 1em; font-weight: 500; color: #0056b3; border-radius: 5px 5px 0 0; transition: background-color 0.2s, color 0.2s; }
.wiki-tab-btn.active { background-color: #007bff; color: white; }
.wiki-tab-btn:hover:not(.active) { background-color: #e9ecef; }
.wiki-tab-content { flex-grow: 1; overflow-y: auto; padding-right: 10px; }
.wiki-page { display: none; }
.wiki-page.active { display: block; }
.wiki-page h3 { margin-top: 10px; margin-bottom: 10px; border-bottom: 1px solid #ccc; padding-bottom: 5px; }
.wiki-page p { font-size: 0.9em; color: #555; margin-bottom: 15px; }
.table-container { overflow-x: auto; }
.wiki-content table { width: 100%; border-collapse: collapse; font-size: 0.9em; }
.wiki-content th, .wiki-content td { padding: 8px 10px; border: 1px solid #ddd; text-align: left; vertical-align: middle; }
.wiki-content thead th { background-color: #f2f2f2; font-weight: bold; }
.wiki-content tbody tr:nth-child(even) { background-color: #f9f9f9; }
.wiki-regiment-icon { font-size: 1.5em; width: 30px; text-align: center; }
.wiki-stars { color: #f39c12; white-space: nowrap; }
#wikiConceptsContent div { margin-bottom: 20px; }
#wikiConceptsContent h4 { font-size: 1.1em; color: #0056b3; margin-bottom: 5px; }

/* --- Modal: Lobby Multijugador --- */
#lanLobbyScreen .container { border: 1px solid #ddd; border-radius: 5px; padding: 15px; margin-top: 15px; background-color: #f9f9f9; }
#lanLobbyScreen h2, #lanLobbyScreen h3 { text-align: center; color: #333; }
#lan-room-id { color: #007bff; font-family: monospace; font-size: 1.1em; user-select: all; }
#lan-status.conectado { color: #28a745; }
#lan-status.desconectado { color: #dc3545; }
#lan-player-list { list-style: none; padding-left: 10px; }
#lan-start-game-btn { display: block; margin: 15px auto 0; width: 60%; padding: 12px; background-color: #28a745; }



/* Modal: Gachas */
#gachaResultList li {
    padding: 8px;
    border-bottom: 1px solid #ced4da;
    font-size: 1.1em;
}

    #gachaResultList li:last-child {
        border-bottom: none;
    }

    /* Colores por rareza en los resultados */
    .rarity-COMUN { color: #6c757d; }
    .rarity-RARO { color: #007bff; font-weight: bold; }
    .rarity-EPICO { color: #8a2be2; font-weight: bold; }
    .rarity-LEGENDARIO { color: #ffc107; font-weight: bold; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); }

/* ========================================================================== */
/* 8. ANIMACIONES (@keyframes)
/* ========================================================================== */

@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
@keyframes shake { 0%, 100% { transform: translateX(0); } 10% { background-color: rgba(255,0,0,0.5); } 20% { transform: translateX(-2px); background-color: transparent; } 40% { transform: translateX(2px); } 60% { transform: translateX(-2px); } 80% { transform: translateX(2px); } }
@keyframes explode { 0% { transform: scale(1) rotate(0deg); opacity: 1; } 50% { transform: scale(1.3) rotate(15deg); opacity: 0.5; } 100% { transform: scale(0.3) rotate(-15deg); opacity: 0; display:none !important; } }
@keyframes unitHit { 0% { transform: translateX(0) translateY(0); } 25% { transform: translateX(-5px) translateY(-5px) rotate(-2deg); } 50% { transform: translateX(5px) translateY(5px) rotate(2deg); } 100% { transform: translateX(0) translateY(0); } }
@keyframes unitAttacking { 0% { transform: scale(1); } 50% { transform: scale(1.1) translateX(5px) translateY(5px); } 100% { transform: scale(1); } }
@keyframes hexHitFlash { 0% { background-color: transparent; } 50% { background-color: rgba(255, 100, 100, 0.7); } 100% { background-color: transparent; } }
@keyframes ownerChangeFlash { 0% { box-shadow: inset 0 0 0 0px transparent; } 50% { box-shadow: inset 0 0 0 5px gold; } 100% { box-shadow: inset 0 0 0 3px var(--owner-color); } }
.explosion-animation { position: absolute; width: 32px; height: 32px; background-image: url('images/explosion.png'); background-size: 256px 32px; background-repeat: no-repeat; animation: playExplosion 0.6s steps(8) forwards; z-index: 100; pointer-events: none; transform: translate(-50%, -50%); }
@keyframes playExplosion { from { background-position: 0px; } to { background-position: -1024px; } }
@keyframes floatAndFade { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-50px) scale(0.8); opacity: 0; } }
@keyframes pulseHighlight { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(1.02); opacity: 0.8; } }
@keyframes pulseHighlightHex { 0% { box-shadow: inset 0 0 0 4px gold, inset 0 0 0 8px rgba(0, 255, 255, 0.7); } 100% { box-shadow: inset 0 0 0 6px gold, inset 0 0 0 10px rgba(0, 255, 255, 0.9); } }


/* ========================================================================== */
/* 13. ESTILOS DEL NUEVO MENÚ PRINCIPAL INTERACTIVO (COMPLETO)
/* ========================================================================== */

/* --- Contenedor y Estilo Base de Hotspots --- */

#interactiveBoardContainer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
}

.main-menu-hotspot {
    position: absolute;
  /*  background-color: rgba(255, 0, 0, 0.4); /* Descomentado para que veas las zonas rojas y puedas ajustarlas */
    border-radius: 25px;
    cursor: pointer;
    transition: transform 0.1s ease-out, background-color 0.1s;
    animation: pulse-glow 3s infinite ease-in-out;
}

/* --- Posicionamiento de cada Hotspot (Estimación inicial) --- */

/* Partida Rápida: Tablero hexagonal central */
#hotspotMap {
    top: 45%;
    left: 32%;
    width: 36%;
    height: 50%;
    border-radius: 50%;
    animation-delay: 0s;
}

/* Cuartel: Libro arriba a la izquierda */
#hotspotBarracks {
    top: 20%;
    left: 20%;
    width: 13%;
    height: 28%;
    animation-delay: -0.5s;
}

/* Forja: Manuscrito de Soldado a la izquierda */
#hotspotForge {
    top: 60%;
    left: 12%;
    width: 18%;
    height: 28%;
    animation-delay: -1s;
}

/* Altar de los Deseos: Manuscrito a la derecha arriba de soldado*/
#hotspotAltar {
    top: 20%;
    left: 72%;
    width: 13%;
    height: 28%;
    animation-delay: -1.5s;
}

/* Campaña: Ventana con el Arbol y el rio */
#hotspotCampaign {
    top: 10%;
    left: 35%;
    width: 35%;
    height: 25%;
    animation-delay: -2s;
}

/* Tronos de Iberia: Ruinas a la derecha */
#hotspotThrones {
    top: 60%;
    left: 72%;
    width: 18%;
    height: 28%;
    animation-delay: -2.5s;
}


/* --- Efectos Visuales y Animaciones --- */

@keyframes pulse-glow {
    0% { box-shadow: 0 0 8px 3px rgba(255, 220, 100, 0); }
    50% { box-shadow: 0 0 16px 8px rgba(255, 220, 100, 0.5); }
    100% { box-shadow: 0 0 8px 3px rgba(255, 220, 100, 0); }
}

.main-menu-hotspot:active {
    background-color: rgba(255, 255, 150, 0.35);
    animation: none;
    box-shadow: 0 0 20px 10px rgba(255, 255, 100, 0.6);
    transform: scale(1.05);
}


/* --- UI restante del menú --- */

#generalInfoPanel {
    position: absolute;
    top: 15px;
    right: 15px;
    background-color: rgba(0, 0, 0, 0.6);
    color: #f0e6d2;
    padding: 8px 15px;
    border-radius: 8px;
    border: 1px solid rgba(255, 215, 0, 0.5);
    font-size: 0.9em;
    display: flex;
    align-items: center;
    gap: 15px;
}

#logoutBtn_main {
    background: none;
    border: none;
    color: #f0e6d2;
    font-size: 1.5em;
    cursor: pointer;
    padding: 0;
    line-height: 1;
}

#gameModesModal button {
    background-color: rgba(40, 40, 40, 0.8);
    color: #f0e6d2;
    border: 1px solid rgba(255, 215, 0, 0.7);
    transition: background-color 0.2s;
}

#gameModesModal button:hover,
#gameModesModal button:active {
    background-color: rgba(60, 60, 60, 0.9);
    border-color: rgba(255, 215, 0, 1);
}

/* ========================================================================== */
/* 14. SISTEMA DE NOTIFICACIONES (TOASTS)
/* ========================================================================== */

.toast-notification {
    position: fixed; /* Se pega a la pantalla, no al juego */
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%); /* Lo centra perfectamente */
    padding: 12px 25px;
    background-color: rgba(20, 20, 20, 0.9);
    color: #f0f0f0;
    border-radius: 20px;
    border: 1px solid #555;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
    z-index: 99999; /* Por encima de todo */
    font-size: 1.1em;
    font-weight: 500;
    text-align: center;
    pointer-events: none; /* No se puede hacer clic en la notificación */
    opacity: 0; /* Empieza invisible */
    transition: opacity 0.3s ease-out;

    /* Animación de entrada y salida */
    animation: toast-fade-in-out 3s ease-in-out forwards;
}

/* Tipos de notificación (opcional, pero útil) */
.toast-notification.info {
    border-color: #3498db; /* Azul */
}
.toast-notification.success {
    border-color: #2ecc71; /* Verde */
}
.toast-notification.warning {
    border-color: #f1c40f; /* Amarillo */
}
.toast-notification.error {
    border-color: #e74c3c; /* Rojo */
}


@keyframes toast-fade-in-out {
    0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.8);
    }
    15% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
    }
    85% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
    }
    100% {
        opacity: 0;
        transform: translate(-50%, -70px) scale(0.8);
    }
}

/* ========================================================================== */
/* ==   SOLUCIÓN DEFINITIVA DE CAPTURA DE CLICS                            == */
/* ========================================================================== */

/* 1. La regla más importante de todas.
   Forzamos a TODOS los botones dentro del contenedor de la UI táctica a que
   SIEMPRE acepten eventos de ratón, sin importar el estado de sus padres. */
#tactical-ui-container button {
    pointer-events: all !important;
}

/* 2. El contenedor de las unidades (gameBoard) no debe permitir que las unidades
   (que tienen pointer-events: none) bloqueen los clics al propio tablero. */
#gameBoard {
    pointer-events: all;
}
.unit {
    /* Esta es la regla clave que tenías, la mantenemos.
       La unidad es "invisible" para los clics, que pasan a través de ella
       hasta el hexágono que está debajo. */
    pointer-events: none;
}
/* ========================================================================== */
/* ==   15. SISTEMA DE MODALES DE CONFIGURACIÓN (UNIFICADO Y MOBILE-FIRST) == */
/* ========================================================================== */

/* --- 15.1: Base del Contenedor del Modal (Overlay) --- */
.modal-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.75);
    z-index: 9998;
    align-items: center;
    justify-content: center;
    padding: 10px;
    box-sizing: border-box;
}
.modal-overlay.active {
    display: flex;
}

/* --- 15.2: Base de la Ventana del Modal --- */
.modal-container {
    background-color: #f0f2f5;
    border: 1px solid #ced4da;
    border-radius: 12px;
    box-shadow: 0 5px 25px rgba(0,0,0,0.3);
    width: 95vw;
    height: auto;
    max-width: 500px;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    transform: scale(0.95);
    opacity: 0;
    transition: transform 0.2s ease-out, opacity 0.2s ease-out;
}
.modal-overlay.active .modal-container {
    transform: scale(1);
    opacity: 1;
}

/* --- 15.3: Cabecera, Cuerpo y Pie de Página del Modal --- */
.modal-header {
    flex-shrink: 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    border-bottom: 1px solid #dee2e6;
}
.modal-header h2 {
    margin: 0;
    font-size: 1.3em;
    color: #343a40;
}
.modal-close-btn {
    font-size: 2em;
    color: #6c757d;
    cursor: pointer;
    background: none;
    border: none;
}
.modal-body {
    padding: 20px;
    overflow-y: auto;
}
.modal-footer {
    flex-shrink: 0;
    display: flex;
    justify-content: flex-end;
    gap: 12px;
    padding: 15px 20px;
    background-color: #e9ecef;
    border-top: 1px solid #dee2e6;
    border-radius: 0 0 12px 12px;
}
.modal-footer button {
    padding: 10px 20px;
    font-size: 1em;
    font-weight: 500;
    border-radius: 5px;
    border: none;
    cursor: pointer;
}
.modal-footer .button-primary {
    background-color: #007bff;
    color: white;
}
.modal-footer .button-secondary {
    background-color: #6c757d;
    color: white;
}

/* --- 15.5: Estilos para PANTALLA 2 de Configuración (Jugadores) --- */
#setupScreen2 .modal-body {
    padding: 15px;
}
.player-grid-container {
    display: grid;
    grid-template-columns: repeat(2, 1fr); 
    gap: 10px;
}
/* Para tablets y pantallas un poco más grandes, 4 columnas */
@media (min-width: 500px) {
    .player-grid-container {
        grid-template-columns: repeat(4, 1fr);
    }
}
.player-card {
    background-color: #fff;
    border: 1px solid #ced4da;
    border-radius: 8px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
}
.player-card .player-icon {
    font-size: 1.8em;
    font-weight: bold;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    margin: 0;
    flex-shrink: 0;
}
.player-card select {
    width: 100%;
    padding: 8px 5px;
    font-size: 0.85em;
    border-radius: 4px;
}
.player-card select:disabled {
    background-color: #e9ecef;
    opacity: 0.7;
}

/* Colores para cada icono de jugador (reutilizados) */
.player-icon.player-color-1 { background-color: #007bff; }
.player-icon.player-color-2 { background-color: #dc3545; }
.player-icon.player-color-3 { background-color: #28a745; }
.player-icon.player-color-4 { background-color: #ffc107; }
.player-icon.player-color-5 { background-color: #6f42c1; }
.player-icon.player-color-6 { background-color: #fd7e14; }
.player-icon.player-color-7 { background-color: #20c997; }
.player-icon.player-color-8 { background-color: #e83e8c; }

/* ========================================================================== */
/* ==   DISEÑO SETUP ESCARAMUZA      == */
/* ========================================================================== */

/* --- 1. Contenedor del Modal con fondo oscuro y sin bordes feos --- */
#setupScreen .modal-container {
    background-color: #2c3e50; /* Un azul-gris oscuro, como en un mapa de estrategia */
    border: 2px solid #95a5a6; /* Borde metálico */
    border-radius: 8px;
    box-shadow: 0 0 20px rgba(0,0,0,0.5), inset 0 0 10px rgba(0,0,0,0.3);
    max-width: 95vw;
    height: auto;
    color: #ecf0f1; /* Texto claro */
}

/* --- 2. Cabecera con más estilo --- */
#setupScreen .modal-header {
    padding: 10px 15px; /* Más compacto */
    border-bottom: 1px solid #7f8c8d;
}
#setupScreen .modal-header h2 {
    font-size: 1.1em; /* Título más pequeño */
    color: #f1c40f; /* Tono dorado */
    text-transform: uppercase;
    letter-spacing: 1px;
}
#setupScreen .modal-close-btn {
    color: #bdc3c7;
}


/* --- 3. Cuerpo principal sin padding vertical excesivo y sin scroll --- */
#setupScreen .modal-body.setup-screen-themed {
    display: flex;
    flex-direction: column;
    justify-content: center; /* Centra el contenido */
    gap: 15px;
    padding: 15px;
    overflow: hidden; /* ¡Prohibido el scroll! */
}

/* --- 4. Rejilla 2x3 para las opciones superiores --- */
.options-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr); /* 3 columnas iguales */
    grid-template-rows: auto auto; /* 2 filas, altura automática */
    gap: 8px 12px; /* Espacio vertical y horizontal */
    align-items: center;
}
.options-grid label {
    font-size: 0.75em; /* Etiquetas mucho más pequeñas */
    font-weight: 500;
    text-align: center;
    text-transform: uppercase;
    color: #bdc3c7;
}
.options-grid select {
    width: 100%;
    padding: 6px; /* Selectores más compactos */
    font-size: 0.9em;
    background-color: #34495e; /* Fondo oscuro */
    color: #ecf0f1; /* Texto claro */
    border: 1px solid #7f8c8d;
    border-radius: 4px;
}

/* --- 5. Fila inferior del Slider --- */
.players-row {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
    margin-top: 5px; /* Un pequeño margen superior */
}
.players-row label {
    font-size: 0.9em; /* Tamaño equilibrado */
    font-weight: 500;
    color: #bdc3c7;
}
.players-row #num-players-display {
    color: #f1c40f; /* Dorado, para que destaque */
    font-weight: bold;
    font-size: 1.1em;
}
input[type="range"] {
    width: 90%; /* Ocupa casi todo el ancho */
    margin: 0;
}


/* --- 6. Pie de página más integrado --- */
#setupScreen .modal-footer {
    background-color: #212f3d;
    border-top: 1px solid #7f8c8d;
    padding: 10px 15px;
}

/* ========================================================================== */
/* ==   DISEÑO SETUP SCREEN 2 (TEMÁTICO, HEREDANDO ESTILO)                 == */
/* ========================================================================== */

/* --- 1. Aplicamos el mismo estilo base de contenedor a la pantalla 2 --- */
#setupScreen2 .modal-container {
    background-color: #2c3e50;
    border: 2px solid #95a5a6;
    border-radius: 8px;
    box-shadow: 0 0 20px rgba(0,0,0,0.5), inset 0 0 10px rgba(0,0,0,0.3);
    color: #ecf0f1;
}

/* --- 2. Unificamos el estilo de la cabecera --- */
#setupScreen2 .modal-header {
    padding: 10px 15px;
    border-bottom: 1px solid #7f8c8d;
}
#setupScreen2 .modal-header h2 {
    font-size: 1.1em;
    color: #f1c40f;
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* --- 3. Cuerpo principal sin padding vertical excesivo y sin scroll --- */
#setupScreen2 .modal-body {
    padding: 15px;
    overflow: hidden; /* ¡Prohibido el scroll aquí también! */
}

/* --- 4. Hacemos las tarjetas de jugador mucho más compactas --- */
#setupScreen2 .player-card {
    background-color: #34495e; /* Fondo oscuro para la tarjeta */
    border: 1px solid #7f8c8d;
}

#setupScreen2 .player-card .player-icon {
    box-shadow: 0 0 5px rgba(0,0,0,0.5); /* Sombra para que destaque */
}

#setupScreen2 .player-card select {
    background-color: #2c3e50; /* Un poco más oscuro que la tarjeta */
    color: #ecf0f1;
    border-color: #95a5a6;
}

#setupScreen2 .player-card select:disabled {
    background-color: #212f3d;
    opacity: 0.6;
}


/* --- 5. Unificamos el estilo del pie de página --- */
#setupScreen2 .modal-footer {
    background-color: #212f3d;
    border-top: 1px solid #7f8c8d;
    padding: 10px 15px;
}

/* ========================================================================== */
/* ==   MODALES DE JUEGO (ESTILO TEMÁTICO Y COMPACTO PARA MÓVIL)           == */
/* ========================================================================== */

/* --- Clase base para aplicar el nuevo tema a cualquier modal --- */
.modal-themed .modal-content {
    background-color: #2c3e50;
    border: 2px solid #95a5a6;
    border-radius: 8px;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
    color: #ecf0f1;
    width: 95vw;
    max-width: 500px; /* Un máximo razonable para la mayoría de los modales */
    max-height: 90vh; /* Altura máxima para evitar scroll */
    padding: 0; /* Eliminamos el padding para tener control total */
    display: flex;
    flex-direction: column;
    margin: 0 0 10px 0; /* Reducimos el margen inferior del título */
    font-size: 1.1em; /* Un poco más pequeño para ser más compacto */
}

/* --- Estilo para la cabecera (reutilizable) --- */
.modal-themed .modal-header {
    padding: 10px 15px;
    border-bottom: 1px solid #7f8c8d;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0;
}
.modal-themed h2, .modal-themed h3 {
    margin: 0;
    font-size: 1.1em;
    color: #f1c40f;
    text-transform: uppercase;
    letter-spacing: 1px;
}
.modal-themed .close-button {
    position: static; /* Quitamos el posicionamiento absoluto */
    color: #bdc3c7;
    font-size: 2em;
    float: none;
    line-height: 1;
}

/* --- Estilo para el cuerpo (con scroll si es necesario) --- */
.modal-themed .modal-body {
    padding: 15px;
    overflow-y: auto; /* Permite scroll si el contenido es muy largo */
    flex-grow: 1;
}

/* --- Estilo para el pie de página (reutilizable) --- */
.modal-themed .modal-footer {
    padding: 10px 15px;
    background-color: #212f3d;
    border-top: 1px solid #7f8c8d;
    border-radius: 0 0 6px 6px; /* Bordes redondeados solo abajo */
    flex-shrink: 0;
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

/* ---                  --- */
/*MODALES DE PANTALLAS DE BOTONES*/
/* ---                  --- */

/* ========================================================================== */
/* ==   MODALES DE UNIDAD (💪, ✂️) - ACTUALIZACIÓN A TEMA OSCURO            == */
/* ========================================================================== */

/* --- 1. MODAL DETALLES/REFORZAR UNIDAD (💪) --- */

/* Hacemos el modal más bajo para que no se salga de la pantalla en landscape */
#unitDetailModal .modal-content {
    background-color: #2c3e50;
    border: 2px solid #95a5a6;
    color: #ecf0f1;
    max-height: 95vh;  /* Nunca ocupes más del 95% de la altura */
    height: auto;      /* La altura se adaptará a su contenido */
    padding: 15px;
    box-sizing: border-box; /* Incluye el padding en el tamaño total */

    /* <<== LA MAGIA DEL FLEXBOX ==>> */
    display: flex;
    flex-direction: column; /* Apila los elementos verticalmente */
}

/* Permitimos que el título, los stats y la lista crezcan, pero la lista de regimientos es la que más se expande */

/* El título y los stats principales ocupan el espacio que necesiten */
#unitDetailModal h3, 

/* La lista de regimientos será la única que ocupe el resto del espacio y tendrá scroll si es necesario */
#unitDetailModal .detailed-regiments-list {
    background-color: #34495e;
    border: 1px solid #7f8c8d;
    flex-grow: 1;         /* Haz que este elemento crezca y ocupe el espacio vertical restante */
    overflow-y: auto;     /* Activa el scroll vertical SOLO si la lista no cabe */
    min-height: 100px;    /* Dale una altura mínima para que no desaparezca si no hay regimientos */
}

#unitDetailModal h3 {
    color: #f1c40f; /* Título dorado */
}
/* Panel interno de stats principales */
#unitDetailModal .unit-main-stats {
    flex-shrink: 0; /* No permitimos que se encojan */
    background-color: #34495e; /* Fondo del panel */
    border: 1px solid #7f8c8d;
}
/* Barra de vida principal */
#unitDetailModal .unit-total-health-bar-container {
    background-color: #1f2b38; /* Fondo de la barra oscuro */
    border-color: #7f8c8d;
}
#unitDetailModal .stat-row,
#unitDetailModal #unitDetailTotalHealthText {
    color: #ecf0f1;
}

/* Título de la sección de regimientos */
#unitDetailModal .regiment-section-title {
    color: #bdc3c7;
}

#unitDetailModal .detailed-regiments-list .regiment-detail-item {
    border-bottom: 1px solid #2c3e50; /* Separador oscuro */
}
/* Barra de vida de cada regimiento */
#unitDetailModal .detailed-regiments-list .regiment-health-bar-container {
    background-color: #1f2b38;
}
/* Botón para reforzar regimiento */
#unitDetailModal .reinforce-regiment-btn {
    background: #4a5568;
    border: 1px solid #7f8c8d;
    color: #ecf0f1;
}
#unitDetailModal .reinforce-regiment-btn:hover {
    background-color: #5a6a7a;
    border-color: #f1c40f;
}


/* --- 2. MODAL DIVIDIR UNIDAD (✂️) --- */

/* Aplicamos el tema base al contenedor del modal */
#advancedSplitUnitModal .modal-content {
    background-color: #2c3e50;
    border: 2px solid #95a5a6;
    color: #ecf0f1;
}
#advancedSplitUnitModal h3,
#advancedSplitUnitModal h4 {
    color: #f1c40f; /* Títulos dorados */
}
#advancedSplitUnitModal p {
    color: #bdc3c7; /* Texto descriptivo más tenue */
}
/* Paneles internos de las columnas */
#advancedSplitUnitModal .regiment-column {
    background-color: #34495e;
    border: 1px solid #7f8c8d;
}
#advancedSplitUnitModal .regiment-column p {
    color: #ecf0f1;
}
/* Input para el nombre de la nueva unidad */
#advancedSplitUnitModal #newSplitUnitNameInput {
    background-color: #2c3e50;
    border: 1px solid #7f8c8d;
    color: #f1c40f;
    text-align: center;
}
/* Lista de regimientos en las columnas */
#advancedSplitUnitModal .regiments-list {
    border: 1px solid #7f8c8d;
}
#advancedSplitUnitModal .regiments-list li:hover {
    background-color: #4a5568; /* Resaltado al pasar el ratón */
}
/* Iconos dentro de la lista de división */
#advancedSplitUnitModal .regiments-list li span.regiment-type {
    color: #ecf0f1;
}
/* Botones de acción del pie de página */
#advancedSplitUnitModal button {
    padding: 8px 16px;
    border-radius: 5px;
    border: none;
    color: white;
    font-weight: bold;
}
#advancedSplitUnitModal #finalizeAdvancedSplitBtn {
    background-color: #27ae60; /* Verde */
}
#advancedSplitUnitModal #cancelAdvancedSplitBtn {
    background-color: #7f8c8d; /* Gris */
}

/* ========================================================================== */
/* ==   18. CONSOLA DE DEPURACIÓN (ESTILO RETRO RESTAURADO Y MEJORADO)      == */
/* ========================================================================== */

#debug-console {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 35%; /* Ocupa un poco más de un tercio de la pantalla */
    
    background-color: rgba(10, 20, 15, 0.85); /* Negro verdoso muy oscuro y translúcido */
    border-top: 2px solid rgba(0, 255, 127, 0.5); /* Borde superior verde neón */
    
    display: flex;
    flex-direction: column;
    font-family: 'Consolas', 'Lucida Console', 'Courier New', monospace; /* Fuente de terminal */
    
    /* Pequeño efecto de resplandor para el texto, como en un monitor CRT */
    text-shadow: 0 0 3px rgba(57, 255, 20, 0.3);

    box-shadow: 0 -5px 15px rgba(0,0,0,0.4);
    z-index: 10000;
}

#console-output {
    flex-grow: 1; /* Ocupa todo el espacio disponible */
    overflow-y: auto;
    padding: 10px;
    font-size: 0.9em;
    color: #39FF14; /* Color verde neón base */
    scrollbar-width: thin;
    scrollbar-color: #39FF14 rgba(10, 20, 15, 0.85);
}

#console-output > div {
    margin-bottom: 5px;
    line-height: 1.4;
    word-break: break-word; /* Evita que el texto largo se desborde */
}

/* --- Colores por tipo de evento (como pediste) --- */
#console-output .log-info {
    color: #E0E0E0; /* Texto blanco/gris claro para logs generales */
}

#console-output .log-success {
    color: #00FF7F; /* Verde primavera para éxitos */
}

#console-output .log-warning {
    color: #FFD700; /* Amarillo/Dorado para advertencias */
}

#console-output .log-error {
    color: #FF4500; /* Rojo anaranjado para errores */
    font-weight: bold;
}

#console-output .log-command {
    color: #87CEEB; /* Azul cielo para los comandos que se escriben */
    font-style: italic;
}


#console-input {
    width: 100%;
    padding: 8px 10px;
    box-sizing: border-box;
    
    background-color: #000;
    border: none;
    border-top: 1px solid rgba(0, 255, 127, 0.4);
    
    color: #39FF14; /* Texto de entrada también verde */
    font-family: inherit; /* Hereda la fuente monoespaciada */
    font-size: 1em;
}

#console-input:focus {
    outline: none;
    background-color: #111;
}

/* ========================================================================== */
/* ==   NUEVO MENÚ SUPERIOR (☰) - BARRA COMPACTA                           == */
/* ========================================================================== */

/* --- 1. La barra principal transparente --- */
.top-bar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    
    display: flex;
    justify-content: space-between; /* Pone la info a la izq y los botones a la der */
    align-items: flex-start; /* Alinea los paneles arriba */
    
    padding: 8px;
    box-sizing: border-box;
    
    /* El truco para poder hacer clic "a través" de las áreas vacías de la barra */
    pointer-events: none; 
    
    background: linear-gradient(to bottom, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0) 100%);
    z-index: 1000;
}

/* --- 2. Paneles internos (los que sí reciben clics) --- */
.top-bar-panel {
    background-color: rgba(44, 62, 80, 0.9); /* Fondo temático oscuro translúcido */
    border: 1px solid #7f8c8d;
    border-radius: 6px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.4);
    padding: 8px;
    color: #ecf0f1;
    font-size: 0.8em;
    pointer-events: all; /* IMPORTANTE: Permite hacer clic DENTRO de los paneles */
    flex-shrink: 0;
}

/* --- 3. Panel izquierdo (información) --- */
#top-bar-info #top-bar-phase-turn {
    font-weight: bold;
    margin-bottom: 5px;
    white-space: nowrap; /* Evita que el texto se rompa */
    color: #f1c40f; /* Título dorado */
}
#top-bar-info #top-bar-resources {
    display: flex;         /* <-- 1. Cambiamos a Flexbox */
    flex-wrap: nowrap;     /*     Asegura que se mantenga en una línea */
    justify-content: space-between; /* <-- 2. Distribuye el espacio entre los ítems */
    gap: 8px;              /* <-- 3. Un pequeño espacio mínimo garantizado */
}

.resource-item {
    display: flex;
    flex-direction: column; /* Etiqueta arriba, valor abajo */
    align-items: center;
}
.resource-item span {
    font-weight: 500;
    color: #bdc3c7; /* Etiqueta más tenue */
}
.resource-item strong {
    font-weight: bold;
}

/* --- 4. Panel derecho (acciones) --- */
.top-bar-actions-panel {
    display: flex;
    gap: 8px;
    padding: 4px; /* Un poco menos de padding para que los botones encajen mejor */
}

.top-bar-actions-panel button,
.top-bar-actions-panel .button-like-label {
    width: 36px;
    height: 36px;
    font-size: 18px;
    background-color: #34495e;
    color: #ecf0f1;
    border: 1px solid #7f8c8d;
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}
.top-bar-actions-panel button:hover,
.top-bar-actions-panel .button-like-label:hover {
    background-color: #4a5568;
    border-color: #f1c40f;
}

/* ========================================================================== */
/* ==   ESTILO DEL CAMINO                 == */
/* ========================================================================== */

/* Esta regla dibuja la capa marrón con la forma hexagonal correcta */
#gameBoard .hex.structure-Camino::after {
    content: ''; 
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    /* FORZAMOS la forma hexagonal para que no dependa de herencia */
    clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
    background-color: rgba(139, 69, 19, 0.6); /* Marrón semi-transparente */
    z-index: 1; 
    pointer-events: none;
}

/* Esta regla se asegura de OCULTAR SIEMPRE el emoji del camino */
#gameBoard .hex.structure-Camino .structure-sprite {
    display: none !important;
}

/* ========================================================================== */
/* ==   OPTIMIZACIÓN MODAL DE UNIDADES (➕)     == */
/* ========================================================================== */

/* ========================================================================== */
/* ==   CORRECCIÓN MODAL DE UNIDADES (MÓVIL-FIRST Y PRECISO)              == */
/* ========================================================================== */
/* ========================================================================== */
/* ==   SOLUCIÓN MODAL DE UNIDADES (ENFOQUE PRECISO Y DEFINITIVO)           == */
/* ========================================================================== */
/* ========================================================================== */
/* ==   SOLUCIÓN MODAL UNIDADES (ENFOQUE EQUILIBRADO Y CORRECTO)            == */
/* ========================================================================== */

/* ========================================================================== */
/* ==   SOLUCIÓN DEFINITIVA: MODAL DE UNIDADES (ESTRUCTURA PROFESIONAL)    == */
/* ========================================================================== */

/* ========================================================================== */
/* ==   SOLUCIÓN MINUCIOSA Y FINAL: Solo los 2 cambios solicitados         == */
/* ========================================================================== */

/* ========================================================================== */
/* ==   SOLUCIÓN FINAL Y MINUCIOSA (v. Correcta)                             == */
/* ==   Aplicando solo los 2 cambios solicitados y corrigiendo mis errores.  == */
/* ========================================================================== */

/* ========================================================================== */
/* ==   SOLUCIÓN FINAL, CUIDADOSA Y CORRECTA PARA EL MODAL DE UNIDADES      == */
/* ========================================================================== */

/* --- 1. CONTENEDOR PRINCIPAL: El marco del modal. --- */
/* Su única función es definir el tamaño máximo y ser un contenedor flex vertical. */
#unitManagementModal .modal-content {
    width: 95vw;
    max-width: 600px;
    max-height: 90vh; /* Límite MÁXIMO de altura. No crecerá más que esto. */

    display: flex;
    flex-direction: column; /* Apila Título, Cuerpo y Pie de página. */
    
    overflow: hidden; /* IMPIDE que el propio modal tenga un scroll general. */
    
    background-color: #2c3e50;
    font-size: 0.9em;
    position: relative;
    padding: 0;
    border-radius: 8px;
}

/* --- 2. TÍTULO Y PIE DE PÁGINA: Secciones fijas. --- */
/* Nunca se encogen y siempre están visibles. */
#unitManagementModal h3,
#unitManagementModal .modal-footer-actions {
    flex-shrink: 0;
}
/* Estilo del botón de cerrar (corregido) */
#unitManagementModal .close-button {
    position: absolute;
    top: 10px; right: 15px; z-index: 10;
}

/* --- 3. CUERPO: La única sección que puede hacer scroll. --- */
/* Se estira para llenar el espacio entre el título y el pie de página. */
#unitManagementModal .unit-management-body {
    flex-grow: 1; /* Le dice al cuerpo que ocupe todo el espacio vertical disponible. */
    overflow-y: auto; /* ¡AQUÍ ESTÁ LA ÚNICA BARRA DE SCROLL! */

    display: flex; /* Mantiene el layout de 2 columnas para los paneles. */
    min-height: 0; /* Un truco de Flexbox para que funcione bien en todos los navegadores. */
}

/* --- 4. PANELES: Ya no necesitan scroll ni alturas máximas. --- */
/* Simplemente crecen lo que necesiten dentro de su padre con scroll. */
#unitManagementModal .unit-selection-panel,
#unitManagementModal .division-summary-panel {
    flex: 1; /* Ocupan 50% del ancho. */
    height: auto;
    overflow: visible;
    padding: 10px;

    /* CORRECCIÓN DE FONDOS */
    background-color: transparent; /* El panel izquierdo es transparente. */
}
#unitManagementModal .division-summary-panel {
    background-color: #212f3d; /* El derecho tiene su propio fondo oscuro. */
}

/* --- 5. Las listas internas. --- */
/* Ya no necesitan NINGUNA regla de altura o scroll. */
#unitManagementModal .available-units-list,
#unitManagementModal #divisionCompositionList {
    height: auto;
    max-height: none;
    flex-grow: 1;       /* Ocupa el espacio vertical sobrante. */
    overflow-y: auto;   /* Muestra un scroll si la lista es muy larga. */
    min-height: 0;      /* Truco de flexbox para asegurar que se comporte bien. */
    
    /* Le añadimos un estilo visual consistente con el panel derecho. */
    border: 1px solid #7f8c8d;
    background-color: #34495e;
    border-radius: 4px;
    margin-top: 10px;
    padding: 5px;
}

/* Esta regla es para el panel izquierdo (reduce el espacio de cada línea) */
#unitManagementModal .unit-entry {
    padding: 2px 2px;
}

/* 1. Convertimos el panel izquierdo en una columna flexible. */
#unitManagementModal .unit-selection-panel {
    display: flex;
    flex-direction: column;
}

/* panel Derecho, Cada item de la lista (icono y cantidad) */
#unitManagementModal .compact-composition-list li {
    display: flex;
    align-items: center;
    font-size: 1em;
    padding: 1px 1px;
    background-color: rgba(44, 62, 80, 0.7);
    border-radius: 2px;
    margin-bottom: 2px;
}

/* 1. Hacemos que el panel derecho sea una columna flex para controlar su contenido. */
#unitManagementModal .division-summary-panel {
    display: flex;
    flex-direction: column;
}

/* 2. Hacemos que la lista de unidades sea la ÚNICA que se estire y tenga scroll. */
#unitManagementModal #divisionCompositionList {
    flex-grow: 1;      /* La lista ocupa todo el espacio vertical sobrante DENTRO del panel. */
    overflow-y: auto;  /* Si la lista crece, ella misma tendrá scroll. */
    min-height: 50px;  /* Le damos una altura mínima para que no desaparezca si está vacía. */
    
    /* Pequeños ajustes visuales para el contenedor de la lista */
    border: 1px solid #7f8c8d;
    background-color: #34495e;
    border-radius: 4px;
    margin: 10px 0;
    padding: 5px;
}

/* --- 6. Iconos y Fuentes (revisado para ser correcto) --- */
#unitManagementModal .compact-composition-list .regiment-icon-emoji {
    font-size: 1.4em;
    line-height: 1;
}
#unitManagementModal .compact-composition-list .regiment-icon-image {
    width: 24px;
    height: 24px;
}
#unitManagementModal .summary-details {
    margin-top: auto; /* Mantiene el resumen pegado abajo. */
}

/* ========================================================================== */
/* ==   DISEÑO ADAPTABLE RÁPIDO PARA MÓVILES (CUARTEL, DESEOS, FORJA)      == */
/* ========================================================================== */

/* Esta regla se aplica a pantallas de 620px de ancho o menos (tablets y móviles) */
@media (max-width: 620px) {

    /* --- REGLA GENERAL PARA TODOS LOS MODALES EN MÓVIL --- */
    /* Hacemos que los modales ocupen casi toda la pantalla y reducimos su padding. */
    .modal-themed .modal-content {
        width: 95vw !important;
        max-width: 95vw !important;
        max-height: 85vh !important;
        padding: 10px !important;
    }

    /* --- 1. SOLUCIÓN PARA EL CUARTEL DE HÉROES --- */
    #barracksModal .hero-collection-grid {
        /* Hacemos las tarjetas más pequeñas para que quepan 2 o 3 por fila */
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 10px;
    }
    /* Reducimos el tamaño de la imagen y las fuentes dentro de cada tarjeta */
    #barracksModal .hero-card-image {
        width: 60px;
        height: 60px;
    }
    #barracksModal .hero-name {
        font-size: 0.9em;
    }
    #barracksModal .hero-level {
        font-size: 0.8em;
    }


    /* --- 2. SOLUCIÓN PARA EL ALTAR DE LOS DESEOS --- */
    #deseosModal .wish-actions {
        /* Apila los dos botones grandes verticalmente en lugar de uno al lado del otro */
        flex-direction: column;
    }
    #deseosModal h2 { font-size: 1.5em; } /* Título más pequeño */
    #deseosModal p { font-size: 0.9em; } /* Texto más pequeño */


    /* --- 3. SOLUCIÓN PARA LA FORJA --- */
    #forgeModal .forge-container {
        /* Apila las dos columnas (lista y detalles) verticalmente */
        flex-direction: column;
        height: auto; /* Permitimos que la altura crezca lo necesario */
        max-height: 70vh; /* Pero limitamos su altura total */
    }

    #forgeModal .blueprint-list {
        /* Damos una altura fija a la lista de planos para que no ocupe toda la pantalla */
        max-height: 200px; /* O unos 25vh, como prefieras */
        flex-shrink: 0; /* Evita que se encoja */
    }
}

/* ========================================================================== */
/* ==   DISEÑO ADAPTABLE MÓVIL (V6 - VERSIÓN CORREGIDA Y FINAL)              == */
/* ========================================================================== */

@media (max-width: 768px) {

    /* --- CONTENEDOR PRINCIPAL: Flex vertical para anclar el footer --- */
    .modal-themed .modal-content {
       /* width: 98vw !important;
        max-width: 98vw !important;*/
        height: 95vh !important;
        padding: 5px !important;
        display: flex;
        flex-direction: column;
    }

    #heroDetailModal .close-button { position: absolute; top: 5px; right: 10px; z-index: 10; }
    #heroDetailModal h2 { display: none; }


    /* --- LAYOUT PRINCIPAL: Columnas con tamaño más controlado --- */
    #heroDetailModal .hero-main-layout {
        /* ¡LA SOLUCIÓN A LA COLUMNA ANCHA! La columna de equipo ahora tiene un tamaño más fijo. */
        grid-template-columns: 1fr 1fr 0.8fr;
        gap: 5px;
        align-items: center; /* Volvemos a centrar verticalmente, se ve mejor */
    }

    #heroDetailModal .hero-main-layout .hero-column { padding: 0 3px; }


    /* --- HABILIDADES: Restaurado el layout 2x2 --- */
    #heroDetailModal .skills-list {
        display: grid; /* ¡LA REGLA QUE HABÍA QUITADO! */
        grid-template-columns: 1fr 1fr;
        gap: 5px;
    }

    /* Refinamos el tamaño de las habilidades para que encajen bien */
    #heroDetailModal .skill-item-rok { margin-bottom: 0; flex-direction: column; align-items: center; gap: 2px; }
    #heroDetailModal .skill-item-rok .skill-icon { width: 40px; height: 40px; font-size: 20px; }
    #heroDetailModal .skill-item-rok .skill-level { width: 18px; height: 18px; line-height: 18px; font-size: 0.7em; }
    #heroDetailModal .skill-item-rok .skill-info h5 { font-size: 0.75em; text-align: center; }
    #heroDetailModal .skill-item-rok .skill-info p { display: none; }


    /* --- PANEL CENTRAL (Mantenemos la reducción de tamaño) --- */
    #heroDetailModal .hero-center-column { font-size: 0.7em; }
    #heroDetailModal #hero-portrait-container { width: 55px; height: 55px; }
    #heroDetailModal .hero-name-title { margin-bottom: 4px; }
    #heroDetailModal .hero-name-title h2 { font-size: 1em; margin: 0; }
    #heroDetailModal .hero-name-title p { display: none; }
    #heroDetailModal .progress-item { margin-bottom: 4px; }
    #heroDetailModal .xp-bar-container { height: 10px; }


    /* --- EQUIPO (Mantenemos la reducción de tamaño) --- */
    #heroDetailModal .equipment-layout { gap: 3px; font-size: 0.7em; }
    #heroDetailModal .equipment-slot { height: 35px; }
    #heroDetailModal .equip-row-middle { gap: 3px; }
    #heroDetailModal #equip-chest, #heroDetailModal #equip-legs { width: 35px; }


    /* --- FOOTER ANCLADO ABAJO (Sin cambios, sigue siendo la clave) --- */
    #heroDetailModal .hero-detail-footer {
        margin-top: auto;
        padding-top: 5px;
        border-top: 1px solid #7f8c8d;
        flex-wrap: wrap;
        justify-content: center;
        gap: 8px;
    }
}

 /* ========================================================================== */
/* ==   DISEÑO ADAPTABLE (SOLUCIÓN EXCLUSIVA PARA PANTALLA DE TALENTOS)      == */
/* ========================================================================== */

/* Dentro de @media (max-width: 768px) { ... } */

    /* --- AJUSTE DE ANCHO PARA LA PANTALLA DE TALENTOS --- */
    
    #talentTreeModal .modal-content {
        /*
        Hacemos la ventana de talentos más estrecha.
        width: 90vw !important;              <-- La regla original de tu CSS que lo hace ancho.
        */
        width: 98vw !important; /* Mantenemos el ancho para tener espacio para el árbol */
        max-width: 98vw !important; /* Forzamos a que nunca sea más ancho */
        height: 90vh !important;
        padding: 8px !important;
    }

    /* Y hacemos que su encabezado sea flexible para que no se rompa en pantallas pequeñas */
    #talentTreeModal .talent-modal-header {
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
        padding-bottom: 8px;
    }

    #talentTreeModal .talent-modal-header h2 {
        width: 100%;
        text-align: center;
        font-size: 1.1em;
        margin: 0;
    }

    #talentTreeModal .talent-points-counter,
    #talentTreeModal #resetTalentsBtn {
        font-size: 0.9em;
    }
    /*-------------------------*/
    @media (max-width: 768px) {

    /* ... aquí van todas tus otras reglas para #heroDetailModal, #skillDetailModal, etc. ... */
    
    
    /* --- SOLUCIÓN PARA LA PANTALLA DE TALENTOS (CON MOVIMIENTO Y ZOOM) --- */
    
    /* 1. Mantenemos el contenedor principal con scroll, como debe ser. */
    #talentCanvasContainer {
        overflow: auto; /* ¡RECUPERAMOS EL MOVIMIENTO! */

        /* IMPORTANTE: Le damos una pista al navegador para que el zoom por pellizco funcione bien. */
        touch-action: pan-x pan-y;
    }

    /* 2. Reducimos el tamaño del lienzo, PERO NO TANTO. */
    #talentTreeModal .talent-tree-canvas {
        /* Tamaño reducido a la mitad (1500px -> 750px). Es un buen punto intermedio. */
        width: 750px;
        height: 750px;

        /* ESCALAMOS EL CONTENIDO a la mitad, no a 1/3. Así sigue siendo legible. */
        transform: scale(0.5);
        
        transform-origin: top left;
    }

    /* 3. Nos aseguramos de que el modal de talentos aproveche bien la pantalla. */
    #talentTreeModal .modal-content {
        width: 100vw !important;  /* Usamos todo el ancho de la pantalla */
        height: 100vh !important; /* Y casi todo el alto */
        padding: 5px !important;  /* Con un padding mínimo */
    }
}

/* ========================================================================== */
/* ==   DISEÑO ADAPTABLE (V10 - COMPACTACIÓN VERTICAL AGRESIVA)            == */
/* ========================================================================== */

/* Dentro de @media (max-width: 768px) { ... } */

    /* --- SOLUCIÓN PARA LA PANTALLA DE HABILIDADES (Miniaturización Extrema) --- */

    #skillDetailModal .skill-detail-content {
        width: auto !important;
        max-width: 500px !important;
        padding: 8px;
    }

    /* ¡CLAVE 1: REINICIO GLOBAL DE ESPACIOS PARA TODOS LOS HIJOS DEL MODAL! */
    #skillDetailModal .skill-detail-content * {
        margin: 0 !important;      /* Elimina TODOS los márgenes de todos los elementos internos. */
        line-height: 1.1 !important; /* Forza un interlineado súper compacto. */
    }

    /* Ahora aplicamos pequeños espacios SOLO donde los necesitamos */
    
    #skillDetailModal .skill-detail-header {
        display: flex;
        align-items: center;
        gap: 8px;
        padding-bottom: 5px; /* Un poco de espacio antes de la línea */
        margin-bottom: 5px !important; /* Un poco de espacio después de la línea */
        border-bottom: 1px solid #dee2e6;
    }

    #skillDetailModal .skill-detail-header .skill-icon {
        width: 35px;
        height: 35px;
        font-size: 18px;
    }

    #skillDetailModal .skill-detail-header h3,
    #skillDetailModal .skill-detail-header p {
        font-size: 0.8em;
    }

    #skillDetailModal .skill-detail-body p {
        font-size: 0.8em;
        margin-bottom: 5px !important; /* Espacio después de la descripción */
    }

    #skillDetailModal .skill-detail-body h4 {
        font-size: 0.9em;
        margin-bottom: 4px !important; /* Espacio antes de la lista de niveles */
    }

    /* ¡CLAVE 2: LA LISTA DE NIVELES SÚPER COMPACTA! */
    #skillDetailModal #skillLevelPreview .level-row {
        font-size: 0.75em;
        padding: 1px 3px !important; /* Padding mínimo */
        margin-bottom: 1px !important; /* Separación mínima entre líneas */
    }

    #skillDetailModal .skill-detail-footer {
        margin-top: 8px !important; /* Espacio antes del footer */
        padding-top: 5px !important;
        border-top: 1px solid #dee2e6;
        display: flex;
        flex-direction: column;
        align-items: stretch;
        gap: 5px;
    }

    #skillDetailModal #upgradeSkillBtn {
        font-size: 0.9em;
        padding: 5px;
    }

   /* ========================================================================== */
/* ==   DISEÑO ADAPTABLE (V15 - FORJA INTELIGENTE Y COMPACTA PARA MÓVIL)    == */
/* ========================================================================== */

/* Dentro de @media (max-width: 768px) { ... } */

    /* --- SOLUCIÓN PARA LA FORJA (Rediseño Compacto) --- */

    /* 1. OCULTAMOS ELEMENTOS REDUNDANTES Y PREPARAMOS EL MODAL */
    #forgeModal h2,
    #forgeModal > p {
        display: none; /* Ocultamos el título "Forja del General" y la descripción. */
    }
    #forgeModal .close-button {
        position: absolute;
        top: 8px; right: 10px; z-index: 10;
        transform: scale(0.9);
    }
    #forgeModal .forge-container {
        flex-direction: row;
        gap: 8px;
        height: 100%; /* El contenedor ahora usa toda la altura del modal */
    }


    /* --- 2. PANEL IZQUIERDO: REDISEÑO A "ICONO + DOS LÍNEAS" --- */
    #forgeModal .blueprint-list {
        padding: 5px;
        flex: 1.2; /* Damos un poco más de espacio a la lista */
        overflow-y: auto; /* Nos aseguramos de que tenga scroll */
    }
    #forgeModal .blueprint-item {
        display: grid; /* ¡LA CLAVE! Usamos grid para un control preciso. */
        grid-template-columns: auto 1fr; /* Columna para el icono, y el resto para el texto. */
        grid-template-rows: auto auto;    /* Dos filas para el texto. */
        grid-template-areas:
            "icon name"
            "icon progress";
        align-items: center;
        gap: 0 8px; /* Espacio solo entre columnas, no entre filas. */
        padding: 4px;
        text-align: left; /* Alineamos el texto a la izquierda. */
    }
    #forgeModal .blueprint-item.selected {
        background-color: #4a5568;
    }

    #forgeModal .blueprint-item .item-icon {
        grid-area: icon;
        font-size: 2em;
        margin: 0;
    }
    #forgeModal .blueprint-item .item-info .item-name {
        grid-area: name;
        font-size: 0.9em;
    }
    #forgeModal .blueprint-item .item-info .item-progress {
        grid-area: progress;
        font-size: 0.75em;
    }

    /* Ocultamos el contenedor original de la info de texto, ya que grid lo controla todo. */
    #forgeModal .blueprint-item .item-info {
        display: contents; /* Le decimos al navegador que ignore esta caja. */
    }


    /* --- 3. PANEL DERECHO: SIMPLIFICADO AL MÁXIMO --- */
    #forgeModal .blueprint-detail {
        padding: 8px;
        flex: 1; /* Le damos un poco menos de espacio que a la lista */
        display: flex; /* Lo convertimos en columna flex para controlar el contenido. */
        flex-direction: column;
        justify-content: center; /* Centramos verticalmente lo que queda. */
        gap: 15px; /* Espacio generoso entre los 3 elementos. */
    }

    /* Ocultamos el icono y el nombre, que ya están visibles en la selección. */
    #forgeModal #blueprintItemIcon,
    #forgeModal #blueprintItemName,
    #forgeModal hr,
    #forgeModal h4 {
        display: none !important;
    }

    #forgeModal #blueprintItemStats {
        text-align: center;
        font-size: 0.9em;
        font-style: normal; /* Le quitamos la cursiva. */
        font-weight: bold;
    }
    
    #forgeModal #forgeItemBtn {
        font-size: 1em;
        padding: 10px;
        margin: 0; /* Quitamos cualquier margen que interfiera. */
    }

    /* ========================================================================== */
/* ==   NUEVO DISEÑO PARA EL ALTAR DE LOS DESEOS (GACHA)                   == */
/* ========================================================================== */

.gacha-main-layout {
    display: grid;
    grid-template-columns: 250px 1fr 220px; /* Izquierda | Centro (flexible) | Derecha */
    gap: 15px;
    height: 100%;
    padding-top: 20px;
}

.gacha-column {
    background-color: rgba(0, 0, 0, 0.3);
    border: 1px solid #7f8c8d;
    border-radius: 8px;
    padding: 15px;
    display: flex;
    flex-direction: column;
}

.gacha-column h3 {
    text-align: center;
    margin-top: 0;
    margin-bottom: 10px;
    color: #f1c40f;
    font-size: 1.2em;
}

/* --- Columna de Historial --- */
#gacha-history-list {
    list-style: none;
    padding: 0;
    margin: 0;
    flex-grow: 1;
    overflow-y: auto;
    font-size: 0.85em;
}
.history-item {
    padding: 4px 8px;
    border-radius: 4px;
    margin-bottom: 3px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.history-item-placeholder { color: #95a5a6; }
.history-item.rarity-raro { background-color: rgba(0, 123, 255, 0.2); border-left: 3px solid #007bff; }
.history-item.rarity-epico { background-color: rgba(138, 43, 226, 0.2); border-left: 3px solid #8a2be2; }
.history-item.rarity-legendario { background-color: rgba(253, 126, 20, 0.2); border-left: 3px solid #fd7e14; font-weight: bold;}
.history-item.crit { color: #f1c40f; font-weight: bold; }


/* --- Columna de Animación --- */
.gacha-animation-column { justify-content: center; align-items: center; }
#gacha-reveal-area {
    width: 100%;
    height: 200px;
    display: flex;
    justify-content: center;
    align-items: center;
    perspective: 1000px;
}
.reveal-placeholder { text-align: center; color: #95a5a6; }
.placeholder-icon { font-size: 3em; opacity: 0.5; }

/* La "carta" que se anima */
.gacha-reveal-card {
    width: 150px;
    height: 180px;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.6s;
    animation: fadeIn-gacha 0.3s ease-out;
}
.gacha-reveal-card.is-flipped { transform: rotateY(180deg); }

.card-face {
    position: absolute;
    width: 100%; height: 100%;
    backface-visibility: hidden;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
}
.card-back {
    background: linear-gradient(145deg, #4a5568, #2c3e50);
    border: 2px solid #95a5a6;
    display: flex; justify-content: center; align-items: center; font-size: 4em;
    color: #f1c40f;
}
.card-front {
    background-color: #34495e;
    transform: rotateY(180deg);
    padding: 10px;
    text-align: center;
    display: flex; flex-direction: column; justify-content: center; align-items: center;
}
.card-front-icon { font-size: 3em; margin-bottom: 5px; }
.card-front-text { font-weight: bold; }
.card-front-amount { font-size: 0.9em; color: #bdc3c7; }

/* Bordes por rareza */
.card-front.rarity-comun { border: 3px solid #adb5bd; }
.card-front.rarity-raro { border: 3px solid #007bff; box-shadow: 0 0 10px #007bff; }
.card-front.rarity-epico { border: 3px solid #8a2be2; box-shadow: 0 0 15px #8a2be2; }
.card-front.rarity-legendario { border: 3px solid #fd7e14; box-shadow: 0 0 20px #fd7e14; }

@keyframes fadeIn-gacha { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }

/* --- Columna de Acciones --- */
.gacha-actions-column { justify-content: center; text-align: center; }
.gacha-actions-column p { font-size: 1.1em; }
.gacha-actions-column #gacha-sellos-count { color: #f1c40f; }

.gacha-button {
    width: 100%;
    padding: 15px 10px;
    margin-top: 15px;
    border-radius: 8px;
    border: 1px solid #95a5a6;
    background-color: #34495e;
    color: #ecf0f1;
    cursor: pointer;
    transition: all 0.2s ease;
}
.gacha-button:hover:not(:disabled) { background-color: #4a5568; transform: translateY(-2px); }
.gacha-button:disabled { opacity: 0.5; cursor: not-allowed; }

.gacha-button .button-main-text { font-size: 1.1em; font-weight: bold; }
.gacha-button .button-cost { display: block; font-size: 0.9em; opacity: 0.8; }
.gacha-button.pull-10 { border-color: #27ae60; background-color: #2c5a41; }

/* --- DISEÑO ADAPTABLE PARA MÓVILES --- */
@media (max-width: 768px) {
    .gacha-main-layout {
        grid-template-columns: 1fr; /* Apilamos las columnas */
        grid-template-rows: auto 1fr auto; /* Damos más espacio a la animación */
        height: auto;
    }
    #gacha-history-list {
        max-height: 120px; /* Limitamos la altura del historial */
    }
}

/* ========================================================================== */
/* ==   DISEÑO ADAPTABLE (V16 - MINIATURIZAR PANTALLA DE DESEOS)            == */
/* ========================================================================== */

/* Dentro de @media (max-width: 768px) { ... } */
    
    /* --- SOLUCIÓN PARA EL ALTAR DE LOS DESEOS (Miniaturizado al 40%) --- */

    /* Forzamos al modal a ser un poco más alto para que quepan las 3 columnas */
    #deseosModal .modal-content {
        height: 280px !important;
    }

    /* Reducimos las 3 columnas y el espacio entre ellas */
    #deseosModal .gacha-main-layout {
        /* Proporciones: 1 (historial), 1 (animación), 0.8 (botones) */
        grid-template-columns: 1fr 1fr 0.8fr; 
        gap: 8px;
        padding-top: 15px;
    }

    #deseosModal .gacha-column {
        padding: 8px; /* Padding más pequeño */
    }

    /* Reducimos la fuente de todos los títulos */
    #deseosModal .gacha-column h3 {
        font-size: 0.9em;
        margin-bottom: 5px;
    }

    /* --- Miniaturizar Historial (Columna Izquierda) --- */
    #deseosModal #gacha-history-list {
        font-size: 0.7em; /* Letra muy pequeña */
    }

    /* --- Miniaturizar Animación (Columna Central) --- */
    #deseosModal #gacha-reveal-area {
        height: auto;
    }
    #deseosModal .gacha-reveal-card {
        width: 100px; /* Tarjeta un 33% más pequeña */
        height: 120px;
        transform: scale(0.9); /* Un truco extra para encogerla un poco más */
    }
    #deseosModal .card-front-icon { font-size: 2em; } /* Icono de premio más pequeño */
    #deseosModal .card-front-icon img { width: 35px !important; height: 35px !important; }
    #deseosModal .card-front-text { font-size: 0.9em; }
    #deseosModal .card-front-amount { font-size: 0.8em; }


    /* --- Miniaturizar Acciones (Columna Derecha) --- */
    #deseosModal .gacha-actions-column p {
        font-size: 0.9em; /* Texto de "Sellos de Guerra" */
    }
    #deseosModal .gacha-button {
        padding: 8px 5px; /* Botones más delgados */
        margin-top: 10px;
    }
    #deseosModal .gacha-button .button-main-text {
        font-size: 0.9em; /* Texto principal del botón */
    }
    #deseosModal .gacha-button .button-cost {
        font-size: 0.75em; /* Coste en sellos */
    }

    /* Ocultamos el apilamiento que definimos antes. Ya no es necesario. */
    .gacha-main-layout {
        grid-template-rows: none;
    }

    /* --- 1. ESTILO PARA PANTALLA GRANDE (ESCRITORIO) --- */

/* Hacemos la "carta" mucho más grande */
.gacha-reveal-card {
    width: 200px;
    height: 240px;
}

/* Aumentamos el tamaño del icono/emoji dentro de la carta */
.card-front-icon {
    font-size: 5em; /* Antes era 3em */
    margin-bottom: 10px;
}

/*imagen <img> sea el triple de grande. */

/* --- 1. ESTILO PARA PANTALLA GRANDE (ESCRITORIO) --- */

.gacha-reveal-card {
    width: 200px;
    height: 240px;
}

.card-front-icon {
    font-size: 5em;
    margin-bottom: 10px;
}

/* Esta es la regla que AHORA SÍ va a funcionar */
.card-front-icon img {
    width: 150px;
    height: 150px;
    border-radius: 10px; /* Un poco de borde redondeado */
}


/* --- 2. AJUSTE PARA MÓVILES --- */
@media (max-width: 768px) {
    
    #deseosModal .gacha-reveal-card {
        width: 120px;
        height: 140px;
    }
    
    #deseosModal .card-front-icon {
        font-size: 1em;
    }
    
    /* Y esta es la regla que funcionará en móvil */
    #deseosModal .card-front-icon img {
        width: 60px;
        height: 60px;
    }
}

/* ========================================================================== */
/* ==   DISEÑO ADAPTABLE (V19 - SOLUCIÓN FINALÍSIMA PARA LA IMAGEN)          == */
/* ========================================================================== */

/* --- TAMAÑO DE LA 'CARTA' EN ESCRITORIO (SE MANTIENE) --- */
.gacha-reveal-card {
    width: 200px;
    height: 240px;
}
.card-front-icon { font-size: 5em; margin-bottom: 10px; }

/* --- TAMAÑO DE LA IMAGEN DENTRO DE LA CARTA EN ESCRITORIO (LA SOLUCIÓN) --- */
.card-front-icon img {
    /* Usamos !important para romper el "candado" de la regla anterior que yo puse. */
    width: 90px !important;
    height: 90px !important;
    border-radius: 10px;
    font-size: initial !important;
}

/* --- AJUSTES PARA MÓVILES (CON LA SOLUCIÓN) --- */
@media (max-width: 768px) {
    #deseosModal .gacha-reveal-card {
        width: 120px;
        height: 140px;
    }
    #deseosModal .card-front-icon img {
        /* También usamos !important aquí para asegurar que funcione en móvil. */
        width: 60px !important;
        height: 60px !important;
    }
    #deseosModal .card-front-icon { font-size: 3.5em; }
}

/* ================================================================= */
/* ==   AJUSTE FINAL DE ALTURA Y 'X' PARA EL ALTAR DE LOS DESEOS  == */
/* ================================================================= */

/* Dentro de @media (max-width: 768px) { ... } */

    /* Forzamos al modal a ser un contenedor "relativo" para poder posicionar la 'X' */
    #deseosModal .modal-content {
        position: relative;
    }

    /* Sacamos la 'X' del flujo para que no ocupe espacio y reducimos la altura */
    #deseosModal .close-button {
        position: absolute;
        top: 8px;
        right: 12px;
        z-index: 10;
    }

    /* ========================================================================== */
/* ==   DISEÑO ADAPTABLE (V20 - MINIATURIZAR PANTALLA DE GESTIÓN 💪)         == */
/* ========================================================================== */

/* Dentro de @media (max-width: 768px) { ... } */

    /* --- SOLUCIÓN PARA LA PANTALLA DE GESTIÓN DE DIVISIÓN (💪) --- */

    /* 1. Reducimos el tamaño general del modal y la fuente base. */
    #unitDetailModal .modal-content {
        width: 95vw !important;
        max-width: 360px !important; /* Hacemos la ventana mucho más estrecha. */
        max-height: 90vh !important;
        font-size: 0.85em; /* Reducimos todo el texto un 15%. */
        padding: 10px !important;
    }

    /* 2. Compactamos el encabezado y el bloque de estadísticas principales. */
    #unitDetailModal h3 {
        font-size: 1.2em;
        margin-bottom: 10px;
    }
    #unitDetailModal .unit-main-stats {
        padding: 8px;
        margin-bottom: 10px;
        gap: 5px; /* Reducimos el espacio entre las filas de stats */
    }
    #unitDetailModal .stat-row {
        padding: 2px 0; /* Hacemos las filas más delgadas. */
    }
    #unitDetailModal .unit-total-health-bar-container {
        height: 16px; /* Barra de vida principal más fina. */
    }

    /* 3. Hacemos la lista de regimientos y sus elementos internos mucho más pequeños. */
    #unitDetailModal .regiment-section-title {
        font-size: 0.9em;
        margin-bottom: 5px;
    }
    #unitDetailModal .detailed-regiments-list .regiment-detail-item {
        padding: 6px 8px; /* Filas de la lista más delgadas. */
        gap: 8px;
    }
    #unitDetailModal .detailed-regiments-list .regiment-icon {
        font-size: 1.2em; /* Iconos más pequeños. */
        margin-right: 5px;
    }
    #unitDetailModal .detailed-regiments-list .regiment-health-bar-container {
        height: 10px; /* Barras de vida individuales más finas. */
    }
    #unitDetailModal .detailed-regiments-list .regiment-health-text {
        font-size: 0.9em;
    }
    #unitDetailModal .reinforce-regiment-btn {
        padding: 3px 6px; /* Botón de reforzar más pequeño. */
        font-size: 0.9em;
    }
}